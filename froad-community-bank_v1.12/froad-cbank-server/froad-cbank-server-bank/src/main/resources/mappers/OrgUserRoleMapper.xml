<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.froad.db.mysql.mapper.OrgUserRoleMapper">

	<resultMap type="OrgUserRole" id="orgUserRoleResultMap">
		<id property="id" column="id" />
		<result property="clientId" column="client_id" />
		<result property="roleName" column="role_name" />
		<result property="roleId" column="role_id" />
		<result property="userId" column="user_id" />
		<result property="orgCode" column="org_code" />
		<result property="username" column="username" />
		<result property="orgLevel" column="org_level" />
	</resultMap>


	<!-- 添加  OrgUserRole -->
	<insert id="addOrgUserRole" parameterType="OrgUserRole" useGeneratedKeys="true" keyProperty="id">
		<![CDATA[
			insert into cb_org_user_role (
				client_id,role_name,role_id,user_id,org_code,username,org_level
			) values (
				#{clientId},#{roleName},#{roleId},#{userId},#{orgCode},#{username},#{orgLevel}
			) 
		]]>
	</insert>


	<!-- 批量添加  OrgUserRole -->
	<insert id="addOrgUserRoleByBatch" parameterType="java.util.List">
		insert into cb_org_user_role (
			client_id,role_name,role_id,user_id,org_code,username,org_level
		) values 
		<foreach collection="orgUserRoleList" item="item" index="index" separator=",">
			(#{clientId},#{roleName},#{roleId},#{userId},#{orgCode},#{username},#{orgLevel})
		</foreach>
	</insert>


	<!-- 删除  OrgUserRole -->
	<delete id="deleteOrgUserRole" parameterType="OrgUserRole">
		delete from cb_org_user_role 
			<where>
				<if test="id != null">
					and id = #{id}
				</if>
				<if test="clientId != null">
					and client_id = #{clientId}
				</if>
				<if test="roleName != null">
					and role_name = #{roleName}
				</if>
				<if test="roleId != null">
					and role_id = #{roleId}
				</if>
				<if test="userId != null">
					and user_id = #{userId}
				</if>
				<if test="orgCode != null">
					and org_code = #{orgCode}
				</if>
				<if test="username != null">
					and username = #{username}
				</if>
				<if test="orgLevel != null">
					and org_level = #{orgLevel}
				</if>
			</where>
	</delete>


	<!-- 修改  OrgUserRole -->
	<update id="updateOrgUserRole" parameterType="OrgUserRole">
		update cb_org_user_role 
			<set>
				<if test="roleName != null">
					 role_name = #{roleName},
				</if>
				<if test="roleId != null">
					 role_id = #{roleId},
				</if>
				<if test="orgCode != null">
					 org_code = #{orgCode},
				</if>
				<if test="orgLevel != null">
					 org_level = #{orgLevel},
				</if>
			</set>
			where id = #{id}
	</update>


	<!-- 查询  OrgUserRole -->
	<select id="findOrgUserRole" parameterType="OrgUserRole" resultMap="orgUserRoleResultMap">
		select 
			id,client_id,role_name,role_id,user_id,org_code,username,org_level 
		from cb_org_user_role 
			<where>
				<if test="id != null">
					and id = #{id}
				</if>
				<if test="clientId != null">
					and client_id = #{clientId}
				</if>
				<if test="roleName != null">
					and role_name = #{roleName}
				</if>
				<if test="roleId != null">
					and role_id = #{roleId}
				</if>
				<if test="userId != null">
					and user_id = #{userId}
				</if>
				<if test="orgCode != null">
					and org_code = #{orgCode}
				</if>
				<if test="username != null">
					and username = #{username}
				</if>
				<if test="orgLevel != null">
					and org_level = #{orgLevel}
				</if>
			</where>
	</select>

	<!-- 分页查询  OrgUserRole -->
	<select id="findByPage" parameterType="java.util.HashMap" resultMap="orgUserRoleResultMap">
		select 
			cr.id,cr.client_id,cr.role_name,cr.role_id,cr.user_id,cr.org_code,cr.username,cr.org_level 
		from cb_org_user_role cr 
		<if test="orgUserRole != null">
			<if test="orgUserRole.orgCodes != null and orgUserRole.orgCodes.size>0">
				INNER JOIN (select org_code from cb_org where (
					province_agency IN
					<foreach collection="orgUserRole.orgCodes" item="item" open="(" separator="," close=")">
                    	#{item}
             		</foreach>
		 			OR city_agency IN
		 			<foreach collection="orgUserRole.orgCodes" item="item" open="(" separator="," close=")">
                    	#{item}
             		</foreach>
		 			OR county_agency IN
		 			<foreach collection="orgUserRole.orgCodes" item="item" open="(" separator="," close=")">
                    	#{item}
             		</foreach>
		 			OR org_code IN 
		 			<foreach collection="orgUserRole.orgCodes" item="item" open="(" separator="," close=")">
                    	#{item}
             		</foreach>
		 			) AND client_id=#{orgUserRole.clientId} and is_enable=true)  co  
				ON  cr.org_code=co.org_code  
			</if>
			<where>
				<if test="orgUserRole.id != null">
					and cr.id = #{orgUserRole.id}
				</if>
				<if test="orgUserRole.clientId != null">
					and cr.client_id = #{orgUserRole.clientId}
				</if>
				<if test="orgUserRole.roleName != null">
					and cr.role_name = #{orgUserRole.roleName}
				</if>
				<if test="orgUserRole.roleId != null">
					and cr.role_id = #{orgUserRole.roleId}
				</if>
				<if test="orgUserRole.username != null">
					and cr.username = #{orgUserRole.username}
				</if>
				<if test="orgUserRole.orgLevel != null">
					and cr.org_level = #{orgUserRole.orgLevel}
				</if>
			</where>
		</if>
		order by id desc 
	</select>

</mapper>

