<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.froad.db.mysql.rp_mappers.ReportMerchantOutletMapper">

	<resultMap type="ReportMerchantOutlet" id="reportOutletMap">
		<result property="createTime" column="create_time" />
		<result property="clientId" column="client_id" />
		<result property="orgCode" column="org_code" />
		<result property="orgName" column="org_name" />
		<result property="orgAddress" column="org_address" />
		<result property="forgCode" column="forg_code" />
		<result property="forgName" column="forg_name" />
		<result property="sorgCode" column="sorg_code" />
		<result property="sorgName" column="sorg_name" />
		<result property="torgCode" column="torg_code" />
		<result property="torgName" column="torg_name" />
		<result property="lorgCode" column="lorg_code" />
		<result property="lorgName" column="lorg_name" />
		<result property="merchantId" column="merchant_id" />
		<result property="merchantName" column="merchant_name" />
		<result property="merchantOutletId" column="merchant_outlet_id" />
		<result property="merchantOutletName" column="merchant_outlet_name" />		
		<result property="newOutletCount" column="new_outlet_count" />
		<result property="cancelOutletCount" column="cancel_outlet_count" />
		<result property="disableStatus" column="disable_status" />
	</resultMap>
	
	<resultMap type="ReportMerchantOutletCount" id="reportOutletCountMap">
		<result property="orgName" column="org_name" />
		<result property="outletName" column="outlet_name" />
		<result property="outletAddress" column="outlet_address" />
		<result property="merchantName" column="merchant_name" />
		<result property="merchantOutletCount" column="merchant_outlet_count" />
	</resultMap>	
	
	<sql id="selectColumn">
		create_time,client_id,org_code,org_name,org_address,forg_code,forg_name,sorg_code,sorg_name,torg_code,torg_name,lorg_code,
		lorg_name,merchant_id,merchant_name,merchant_outlet_id,merchant_outlet_name,new_outlet_count,cancel_outlet_count,disable_status 
	</sql>
	
	<insert id="addReportMerchantOutlet" parameterType="ReportMerchantOutlet">
		INSERT INTO cb_report_merchant_outlet(
			<include refid="selectColumn" /> 
		) VALUES (
			#{createTime},#{clientId},#{orgCode},#{orgName},#{orgAddress},#{forgCode},#{forgName},#{sorgCode},#{sorgName},
			#{torgCode},#{torgName},#{lorgCode},#{lorgName},#{merchantId},#{merchantName},#{merchantOutletId},#{merchantOutletName},
			#{newOutletCount},#{cancelOutletCount},#{disableStatus} 
		)
	</insert>
	
	<insert id="addByBatch">
		INSERT INTO cb_report_merchant_outlet(
			<include refid="selectColumn" /> 
		) VALUES 
		<foreach collection="reportMerchantOutlets" item="item" index="index" separator=",">
			(
			#{item.createTime},#{item.clientId},#{item.orgCode},#{item.orgName},#{item.orgAddress},#{item.forgCode},#{item.forgName},
			#{item.sorgCode},#{item.sorgName},#{item.torgCode},#{item.torgName},#{item.lorgCode},#{item.lorgName},#{item.merchantId},
			#{item.merchantName},#{item.merchantOutletId},#{item.merchantOutletName},#{item.newOutletCount},#{item.cancelOutletCount},
			#{item.disableStatus} 
			)
		</foreach>
	</insert>
	
	<select id="findByCondition" parameterType="ReportMerchantOutlet" resultMap="reportOutletMap">
		SELECT <include refid="selectColumn" /> 
		FROM cb_report_merchant_outlet 
		<where>
			<if test="clientId != null">
				AND client_id = #{clientId} 
			</if>
			<if test="merchantId != null">
				AND merchant_id = #{merchantId} 
			</if>
			<if test="merchantOutletId != null">
				AND merchant_outlet_id = #{merchantOutletId} 
			</if>
			<if test="disableStatus != null">
				AND disable_status = #{disableStatus} 
			</if>			
		</where>
	</select>	
	
	<select id="findMerchantOutletCount" parameterType="ReportMerchantOutletCount" resultMap="reportOutletCountMap">
		SELECT sorg_name as org_name,org_name as outlet_name,org_address as outlet_address,merchant_name, 
		sum(new_outlet_count - cancel_outlet_count) as merchant_outlet_count 
		FROM cb_report_merchant_outlet 
		<where>
			<if test="clientId != null">
				AND client_id = #{clientId} 
			</if>
			<if test="orgCode != null">
				AND org_code = #{orgCode} 
			</if>
			<if test="forgCode != null">
				AND forg_code = #{forgCode} 
			</if>
			<if test="sorgCode != null">
				AND sorg_code = #{sorgCode} 
			</if>
			<if test="startTime != null">
				AND create_time >= #{startTime} 
			</if>
			<if test="endTime != null">
			<![CDATA[
				AND create_time <= #{endTime} 
			]]>
			</if>			
		</where>
		GROUP BY client_id,sorg_code,org_code,merchant_id 
	</select>	
</mapper>