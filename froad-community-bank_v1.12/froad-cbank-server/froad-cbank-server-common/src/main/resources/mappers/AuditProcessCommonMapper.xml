<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.froad.db.mysql.mapper.AuditProcessCommonMapper">

	<resultMap type="AuditProcess" id="auditProcessCommonResultMap">
		<id property="id" column="id" />
		<result property="createTime" column="create_time" />
		<result property="clientId" column="client_id" />
		<result property="auditId" column="audit_id" />
		<result property="taskId" column="task_id" />
		<result property="orgCode" column="org_code" />
		<result property="orgName" column="org_name" />
		<result property="auditStage" column="audit_stage" />
		<result property="auditTime" column="audit_time" />
		<result property="auditComment" column="audit_comment" />
		<result property="auditStaff" column="audit_staff" />
		<result property="reviewStaff" column="review_staff" />
		<result property="auditState" column="audit_state" />
	</resultMap>


	<!-- 添加  AuditProcess -->
	<insert id="addAuditProcess" parameterType="AuditProcess" useGeneratedKeys="true" keyProperty="id">
		<![CDATA[
			INSERT INTO cb_audit_process (
				create_time,client_id,audit_id,task_id,org_code,org_name,audit_stage,audit_time,audit_comment,audit_staff,review_staff,audit_state
			) VALUES (
				#{createTime},#{clientId},#{auditId},#{taskId},#{orgCode},#{orgName},#{auditStage},#{auditTime},#{auditComment},#{auditStaff},#{reviewStaff},#{auditState}
			) 
		]]>
	</insert>
	
	<!-- 根据审核流水号auditId查询待审核记录 -->
	<select id="findAuditProcessByAuditId" parameterType="java.util.HashMap" resultMap="auditProcessCommonResultMap">
		select 
			id,create_time,client_id,audit_id,task_id,org_code,org_name,audit_stage,audit_time,audit_comment,audit_staff,review_staff,audit_state        
		from cb_audit_process 
			where audit_id=#{auditId}   
			<if test="auditState != null">
				 and audit_state = #{auditState}      
			</if>
			order by create_time asc   
	</select>

	
	<!-- 修改审核任务订单信息 -->
	<update id="updateAuditProcess" parameterType="AuditTask">
		update cb_audit_process  
		<set>
			<if test="auditTime != null">
				 audit_time = #{auditTime}, 
			</if>
			<if test="auditComment != null">
				 audit_comment = #{auditComment},
			</if>
			<if test="auditState != null">
				 audit_state = #{auditState},
			</if>
			<if test="auditStage != null">
				 audit_stage = #{auditStage},
			</if>
			<if test="reviewStaff != null">
				 review_staff = #{reviewStaff},
			</if>
			<if test="auditStaff != null">
				 audit_staff = #{auditStaff},
			</if>
		</set>
		where audit_id=#{auditId}  and audit_state=0    
	</update>
	

</mapper>

