<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.froad.db.mysql.mapper.BossResourceMapper">
 
 <resultMap id="BaseResultMap" type="Resource">
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="resource_name" jdbcType="VARCHAR" property="resourceName" />
    <result column="type" jdbcType="INTEGER" property="type" />
    <result column="parent_resource_id" jdbcType="BIGINT" property="parentResourceId" />
    <result column="resource_url" jdbcType="VARCHAR" property="resourceUrl" />
    <result column="resource_icon" jdbcType="VARCHAR" property="resourceIcon" />
    <result column="tree_path" jdbcType="CHAR" property="treePath" />
    <result column="is_delete" jdbcType="BIT" property="isDelete" />
     <result column="status" jdbcType="BIT" property="status" />
    <result column="order_value" jdbcType="INTEGER" property="orderValue" />
    <result column="is_system" jdbcType="BIT" property="isSystem" />
    <result column="is_menu" jdbcType="BIT" property="isMenu" />
    <result column="platform" jdbcType="VARCHAR" property="platform" />
    <result column="resource_key" jdbcType="VARCHAR" property="resourceKey" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="is_limit" jdbcType="BIT" property="isLimit" />
  </resultMap>
 
 
	<!-- 添加  Resource -->
	<insert id="addResource" parameterType="Resource" useGeneratedKeys="true" keyProperty="id">
		<![CDATA[
			INSERT INTO cb_resource (
				resource_name,type,parent_resource_id,resource_url,resource_icon,tree_path,is_delete,order_value,is_system,is_menu,resource_key,platform,update_time,is_limit,status
			) VALUES (
				#{resourceName},#{type},#{parentResourceId},#{resourceUrl},#{resourceIcon},#{treePath},#{isDelete},#{orderValue},#{isSystem},#{isMenu},#{resourceKey},#{platform},#{updateTime},#{isLimit},#{status}
			) 
		]]>
	</insert>


	<!-- 批量添加  Resource -->
	<insert id="addResourceByBatch" parameterType="java.util.List">
		INSERT INTO cb_resource (
			resource_name,type,parent_resource_id,resource_url,resource_icon,tree_path,is_delete,order_value,is_system,is_menu,resource_key,platform,update_time,is_limit,status
		) VALUES 
		<foreach collection="resourceList" item="item" index="index" separator=",">
			(#{resourceName},#{type},#{parentResourceId},#{resourceUrl},#{resourceIcon},#{treePath},#{isDelete},#{orderValue},#{isSystem},#{isMenu},#{resourceKey},#{platform},#{updateTime},#{isLimit},#{status})
		</foreach>
	</insert>


	<!-- 删除  Resource -->
	<update id="deleteResource" parameterType="Resource">
		update cb_resource set is_delete = 1 where id = #{id}  and platform = #{platform}
	</update>
	
	<!-- 删除  Resource -->
	<update id="deleteResourceByTreePath" parameterType="Resource">
		update cb_resource set is_delete = 1 where 
			tree_path like CONCAT('%',#{id},'%')  and platform = #{platform}
	</update>


	<!-- 修改  Resource -->
	<update id="updateResource" parameterType="Resource">
		UPDATE cb_resource 
		<set>
				<if test="resourceName != null">
					  resource_name = #{resourceName}, 
				</if>
				<if test="type != null">
					  type = #{type}, 
				</if>
				<if test="parentResourceId != null">
					  parent_resource_id = #{parentResourceId}, 
				</if>
				<if test="resourceUrl != null">
					  resource_url = #{resourceUrl}, 
				</if>
				<if test="resourceIcon != null">
					  resource_icon = #{resourceIcon}, 
				</if>
				<if test="treePath != null">
					  tree_path = #{treePath}, 
				</if>
				<if test="isDelete != null">
					  is_delete = #{isDelete}, 
				</if>
				<if test="orderValue != null">
					  order_value = #{orderValue}, 
				</if>
				<if test="resourceKey != null">
					  resource_key = #{resourceKey}, 
				</if>
				<if test="isMenu != null">
					  is_menu = #{isMenu}, 
				</if>
				<if test="platform != null">
					  platform = #{platform},
				</if>
				<if test="updateTime != null">
					  update_time = #{updateTime}
				</if>
		</set>
		where id = #{id} and is_delete = 0			
	</update>
	
	
	<!-- 查询  Resource -->
	<select id="findResourceByTreePath" parameterType="java.lang.Long" resultMap="BaseResultMap">
		SELECT 
           id, resource_name,type,parent_resource_id,resource_url,resource_icon,tree_path,is_delete,order_value,is_system,is_menu,resource_key,platform,update_time,is_limit   
        FROM cb_resource 
        WHERE 
            tree_path like CONCAT('%',#{resourceId},'%')  
			order by order_value asc
	</select>


	<!-- 查询  Resource -->
	<select id="findResourceById" parameterType="java.lang.Long" resultMap="BaseResultMap">
		SELECT 
           id, resource_name,type,parent_resource_id,resource_url,resource_icon,tree_path,is_delete,order_value,is_system,is_menu,resource_key,platform,update_time,is_limit   
        FROM cb_resource 
        WHERE 
            id = #{id}

	</select>
	
	
	<!-- 查询  Resource -->
	<select id="findResourceByIds" parameterType="java.util.List" resultMap="BaseResultMap">
		SELECT 
           id, resource_name,type,parent_resource_id,resource_url,resource_icon,tree_path,is_delete,order_value,is_system,is_menu,resource_key,platform,update_time,is_limit   
        FROM cb_resource 
        WHERE 
            id in
            <foreach collection="resourceIdList" item="item" open="(" separator="," close=")">
              	#{item}
       		</foreach>  
			order by order_value asc
	</select>

	<!-- 查询  Resource -->
	<select id="findResource" parameterType="Resource" resultMap="BaseResultMap">
		SELECT 
            id, resource_name,type,parent_resource_id,resource_url,resource_icon,tree_path,is_delete,order_value,is_system,is_menu,resource_key,platform,update_time,is_limit  
        FROM cb_resource 
		<where> 
				<if test="id != null">
					AND  id = #{id}  
				</if>
				<if test="resourceName != null">
					AND  resource_name = #{resourceName}  
				</if>
				<if test="type != null">
					AND  type = #{type}  
				</if>
				<if test="parentResourceId != null">
					AND  parent_resource_id = #{parentResourceId}  
				</if>
				<if test="resourceUrl != null">
					AND  resource_url = #{resourceUrl}   
				</if>
				<if test="resourceIcon != null">
					AND  resource_icon = #{resourceIcon}   
				</if>
				<if test="treePath != null">
					AND  tree_path = #{treePath}   
				</if>
				<if test="isDelete != null">
					AND  is_delete = #{isDelete}   
				</if>
				<if test="orderValue != null">
					AND  order_value = #{orderValue}   
				</if>
				<if test="resourceKey != null">
					AND  resource_key = #{resourceKey}   
				</if>
				<if test="isMenu != null">
					AND  is_menu = #{isMenu}   
				</if>
				<if test="platform != null">
					AND  platform = #{platform}
				</if>
		</where>  
		order by order_value asc
	</select>

	<!-- 根据角色查询资源信息 -->
	<select id="findResourceByRole" parameterType="java.util.HashMap" resultMap="BaseResultMap">
		select  resource.id, resource_name,type,parent_resource_id,resource_url,resource_icon,tree_path,is_delete,order_value,is_system,is_menu,resource_key,resource.platform,update_time,is_limit  
		 from cb_resource resource,cb_role_resource role
		 where 
		 resource.id=role.resource_id and role.role_id=#{roleId}
		 
		        <if test="resource.resourceName != null">
				 AND resource_name = #{resource.resourceName}
			</if>
			<if test="resource.type != null">
				 AND type = #{resource.type}
			</if>
			<if test="resource.parentResourceId != null">
				 AND parent_resource_id = #{resource.parentResourceId}
			</if>
			<if test="resource.resourceUrl != null">
				 AND resource_url = #{resource.resourceUrl}
			</if>
			<if test="resource.resourceIcon != null">
				 AND resource_icon = #{resource.resourceIcon}
			</if>
			<if test="resource.treePath != null">
				 AND tree_path = #{resource.treePath}
			</if>
			<if test="resource.isDelete != null">
				 AND is_delete = #{resource.isDelete}
			</if>
			<if test="resource.orderValue != null">
				 AND order_value = #{resource.orderValue}
			</if>
			<if test="resource.resourceKey != null">
				 AND resource_key = #{resource.resourceKey}
			</if>
			<if test="resource.platform != null">
				 AND resource.platform = #{resource.platform}
			</if>
			<if test="resource.isMenu != null">
					AND  is_menu = #{isMenu}  
			</if>
		 
		 order by order_value asc
	</select>
	
	
	
	<!-- 根据角色查询资源信息 -->
	<select id="findResourceByRoles" parameterType="java.util.HashMap" resultMap="BaseResultMap">
		select  resource.id, resource_name,type,parent_resource_id,resource_url,resource_icon,tree_path,is_delete,order_value,is_system,is_menu,resource_key,resource.platform,update_time,is_limit  
		 from cb_resource resource,cb_role_resource role
		 where 
		 resource.id=role.resource_id
		 
		        <if test="resource.resourceName != null">
				 AND resource_name = #{resource.resourceName}
			</if>
			<if test="resource.type != null">
				 AND type = #{resource.type}
			</if>
			<if test="resource.parentResourceId != null">
				 AND parent_resource_id = #{resource.parentResourceId}
			</if>
			<if test="resource.resourceUrl != null">
				 AND resource_url = #{resource.resourceUrl}
			</if>
			<if test="resource.resourceIcon != null">
				 AND resource_icon = #{resource.resourceIcon}
			</if>
			<if test="resource.treePath != null">
				 AND tree_path = #{resource.treePath}
			</if>
			<if test="resource.isDelete != null">
				 AND is_delete = #{resource.isDelete}
			</if>
			<if test="resource.orderValue != null">
				 AND order_value = #{resource.orderValue}
			</if>
			<if test="resource.resourceKey != null">
				 AND resource_key = #{resource.resourceKey}
			</if>
			<if test="resource.platform != null">
				 AND resource.platform = #{resource.platform}
			</if>
			<if test="resource.isMenu != null">
					AND  is_menu = #{isMenu}   
			</if>
			
			  <if test="roles!=null">
	                AND role.role_id in
	                <foreach collection="roles" item="role" index="index" open="(" close=")" separator=",">
	                    #{role}
	                </foreach>
	            </if>  
	            GROUP BY resource.tree_path
	             order by resource.order_value asc 
		 
	</select>
	
	
	<!-- 查询  根据id查询资源的下级资源 -->
	<select id="findChildrenById" parameterType="java.lang.Long" resultMap="BaseResultMap">
		SELECT 
           id, resource_name,type,parent_resource_id,resource_url,resource_icon,tree_path,is_delete,order_value,is_system,is_menu,resource_key,platform,update_time,is_limit   
        FROM cb_resource 
        where 
        	parent_resource_id = #{id}

	</select>
	
	<!-- 查询 资源Key是否存在 -->
	<select id="IsExistsResourceKey" parameterType="java.lang.String" resultMap="BaseResultMap">
		SELECT 
           id, resource_key   
        FROM cb_resource 
        where 
			resource_key = #{resourceKey}
		and is_delete = 0
	</select>
	
	
	
	<!-- 根据用户查询资源信息 -->
<!-- 	<select id="findResourceByUser" parameterType="java.util.HashMap" resultMap="BaseResultMap"> -->
<!-- 		select  id, resource_name,type,parent_resource_id,resource_url,resource_icon,tree_path,is_delete,order_value,is_system,is_menu,resource_key,platform,update_time,is_limit     -->
<!-- 		 from cb_resource resource,cb_user_resource u -->
<!-- 		 where  resource.id=u.resource_id and u.user_id=#{userId} -->
<!-- 		        <if test="resource.resourceName != null"> -->
<!-- 				 AND resource_name = #{resource.resourceName} -->
<!-- 			</if> -->
<!-- 			<if test="resource.type != null"> -->
<!-- 				 AND type = #{resource.type} -->
<!-- 			</if> -->
<!-- 			<if test="resource.parentResourceId != null"> -->
<!-- 				 AND parent_resource_id = #{resource.parentResourceId} -->
<!-- 			</if> -->
<!-- 			<if test="resource.resourceUrl != null"> -->
<!-- 				 AND resource_url = #{resource.resourceUrl} -->
<!-- 			</if> -->
<!-- 			<if test="resource.resourceIcon != null"> -->
<!-- 				 AND resource_icon = #{resource.resourceIcon} -->
<!-- 			</if> -->
<!-- 			<if test="resource.treePath != null"> -->
<!-- 				 AND tree_path = #{resource.treePath} -->
<!-- 			</if> -->
<!-- 			<if test="resource.isDelete != null"> -->
<!-- 				 AND is_delete = #{resource.isDelete} -->
<!-- 			</if> -->
<!-- 			<if test="resource.orderValue != null"> -->
<!-- 				 AND order_value = #{resource.orderValue} -->
<!-- 			</if> -->
<!-- 			<if test="resource.resourceKey != null"> -->
<!-- 				 AND resource_key = #{resource.resourceKey} -->
<!-- 			</if> -->
<!-- 			<if test="resource.platform != null"> -->
<!-- 				 AND platform = #{resource.platform} -->
<!-- 			</if> -->
<!-- 			<if test="resource.isMenu != null"> -->
<!-- 					AND  is_menu = #{isMenu},  -->
<!-- 			</if> -->
		 
<!-- 		 order by tree_path asc -->
<!-- 	</select> -->
	


</mapper>

