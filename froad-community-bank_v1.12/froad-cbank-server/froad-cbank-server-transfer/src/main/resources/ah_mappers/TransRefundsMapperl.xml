<?xml version="1.0" encoding="UTF-8" ?>  
	<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
  		 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.froad.db.ahui.mappers.TransRefundsMapper">

	<resultMap type="TransRefunds" id="TransRefundsResultMap">
		<id property="id" column="id" />		
		<result property="createTime" column="create_time" />
		<result property="updateTime" column="update_time" />		
		<result property="sn" column="sn" />
		<result property="transSn" column="trans_sn" />
		<result property="paySn" column="pay_sn" />
		<result property="type" column="type" typeHandler="com.froad.db.extend.EnumTypeHandler" />
		<result property="refundValue" column="refund_value"/>
		<result property="ticketId" column="ticket_id"/>
		<result property="state" column="state"  typeHandler="com.froad.db.extend.EnumTypeHandler"/>
		<result property="reason" column="reason" />
		<result property="sysUserId" column="sys_user_id"  />
		<result property="remark" column="remark"  />
		<result property="orderId" column="order_id"  />
		<result property="refundOrderId" column="refund_order_id"  />
		<result property="resultCode" column="result_code"  />
		<result property="resultDesc" column="result_desc"  />
		<result property="username" column="username"/>
		<result property="accountId" column="account_id"/>
		<result property="orderAmount" column="order_amount"/>
	</resultMap>
	
	<!-- 查询 -->
	<select id="getTransRefundsByTickeId" parameterType="java.lang.Long" resultMap="TransRefundsResultMap">
		select * from fft_trans_refunds where ticket_id=#{ticketId} and state = '40' order by create_time desc limit 1
	</select>
	
	<!-- 查询全部最终状态的退款记录 -->
	<select id="getTransRefundsAll" resultMap="TransRefundsResultMap">
		select * from fft_trans_refunds tr where exists( select 'z' from (select max(id) id from fft_trans_refunds group by trans_sn,type) aa where aa.id=tr.id) order by trans_sn
	</select>
	
	<!-- 查询组合退款的记录ID -->
	<select id="getTransRefundsDuplicate" resultType="java.util.Map">
		select trans_sn from (select trans_sn,type from fft_trans_refunds group by trans_sn,type) tr group by trans_sn having count(trans_sn)>1
	</select>
	
	
</mapper>