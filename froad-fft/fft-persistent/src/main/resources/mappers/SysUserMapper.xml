<?xml version="1.0" encoding="UTF-8" ?>  
	<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
  		 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.froad.fft.persistent.api.SysUserMapper">

	<resultMap type="SysUser" id="sysUserResultMap">
		<id property="id" column="id" />
		<result property="createTime" column="create_time" />
		<result property="updateTime" column="update_time" />

		<result property="username" column="username" />
		<result property="password" column="password" />
		<result property="alias" column="alias" />
		<result property="email" column="email" />
		<result property="phone" column="phone" />
		<result property="department" column="department" />
		<result property="isEnabled" column="is_enabled" />
		<result property="isLocked" column="is_locked" />
		<result property="loginFailureCount" column="login_failure_count" />
		<result property="lockedDate" column="locked_date" />
		<result property="loginDate" column="login_date" />
		<result property="loginIp" column="login_ip" />
		<result property="clientId" column="client_id" />
	</resultMap>
	
	<!-- 插入 -->
	<insert id="saveSysUser" parameterType="SysUser" useGeneratedKeys="true" keyProperty="id" >
		insert into fft_sys_user values
		(
			#{id},#{createTime},#{updateTime},#{username},#{password},#{alias},#{email},#{phone}
			,#{department},#{isEnabled},#{isLocked},#{loginFailureCount},#{lockedDate},#{loginDate},#{loginIp},#{clientId}
		)
	</insert>

	<!-- 更新 -->
	<update id="updateSysUserById" parameterType="SysUser">
		update fft_sys_user set update_time = #{updateTime}
		<!-- 该字段不应该被修改 
		<if test="username != null">
			,username = #{username}
		</if> -->
		<if test="password != null">
			,password = #{password}
		</if>
		<if test="alias != null">
			,alias = #{alias}
		</if>
		<if test="email != null">
			,email = #{email}
		</if>
		<if test="phone != null">
			,phone = #{phone}
		</if>
		<if test="department != null">
			,department = #{department}
		</if>	
		<if test="isEnabled != null">
			,is_enabled = #{isEnabled}
		</if>
		<if test="isLocked != null">
			,is_locked = #{isLocked}
		</if>
		<if test="loginFailureCount != null">
			,login_failure_count = #{loginFailureCount}
		</if>
		<if test="lockedDate != null">
			,locked_date = #{lockedDate}
		</if>
		<if test="loginDate != null">
			,login_date = #{loginDate}
		</if>
		<if test="loginIp != null">
			,login_ip = #{loginIp}
		</if>
		where id = #{id}
	</update>
	
	<!-- 查询 -->
	<select id="selectSysUserById" parameterType="java.lang.Long" resultMap="sysUserResultMap">
		select * from fft_sys_user where id = #{id}
	</select>
	
	<!-- 根据用户名查找用户 -->
	<select id="selectSysUserByUsername" parameterType="java.lang.String" resultMap="sysUserResultMap">
		select * from fft_sys_user where username = #{username}
	</select>
	
	<!-- 分页查询 -->
	<select id="selectSysUserByPage" parameterType="com.froad.fft.persistent.bean.page.Page" resultMap="sysUserResultMap"> 
		<![CDATA[ 
			select * from fft_sys_user 
		]]>
		
		<!-- 条件 -->
		<if test="pageFilter != null">
			<where>
				<if test="pageFilter.filterEntity != null">
					<if test="pageFilter.filterEntity.username != null">
						and username like CONCAT('%',#{pageFilter.filterEntity.username},'%' ) 
					</if>
					<if test="pageFilter.filterEntity.phone != null">
						and phone like CONCAT('%',#{pageFilter.filterEntity.phone},'%' ) 
					</if>
					<if test="pageFilter.filterEntity.department != null">
						and department=#{pageFilter.filterEntity.department} 
					</if>
					<if test="pageFilter.filterEntity.isEnabled != null">
						and is_enabled like CONCAT('%',#{pageFilter.filterEntity.isEnabled},'%' ) 
					</if>
					<if test="pageFilter.filterEntity.isLocked != null">
						and is_locked=#{pageFilter.filterEntity.isLocked} 
					</if>
					<if test="pageFilter.filterEntity.clientId != null">
						and client_id=#{pageFilter.filterEntity.clientId} 
					</if>
				</if>
				<!-- 时间段条件 -->
				<if test="pageFilter.property != null and pageFilter.startTime != null">
					<![CDATA[
					 and ${pageFilter.property} >= #{pageFilter.startTime}
					]]>
				</if>
				<if test="pageFilter.property != null and pageFilter.endTime != null">
					<![CDATA[
					 and ${pageFilter.property} <= #{pageFilter.endTime}
					]]>
				</if>
			</where>
		</if>
		
		<!-- 排序 --> 
		<if test="order != null">
			<if test="order.property != null and order.direction != null">
				order by ${order.property} ${order.direction} 
			</if>
		</if>
		
	</select>
	
	<!-- 分页总数 -->
	<select id="selectSysUserByPageCount" parameterType="com.froad.fft.persistent.bean.page.Page" resultType="java.lang.Integer"> 
		<![CDATA[ 
			select count(0) from fft_sys_user 
		]]>
		
		<!-- 条件 -->
		<if test="pageFilter != null">
			<where>
				<if test="pageFilter.filterEntity != null">
						<if test="pageFilter.filterEntity.username != null">
						and username like CONCAT('%',#{pageFilter.filterEntity.username},'%' ) 
					</if>
					<if test="pageFilter.filterEntity.phone != null">
						and phone like CONCAT('%',#{pageFilter.filterEntity.phone},'%' ) 
					</if>
					<if test="pageFilter.filterEntity.department != null">
						and department=#{pageFilter.filterEntity.department} 
					</if>
					<if test="pageFilter.filterEntity.isEnabled != null">
						and is_enabled like CONCAT('%',#{pageFilter.filterEntity.isEnabled},'%' ) 
					</if>
					<if test="pageFilter.filterEntity.isLocked != null">
						and is_locked=#{pageFilter.filterEntity.isLocked} 
					</if>
					<if test="pageFilter.filterEntity.clientId != null">
						and client_id=#{pageFilter.filterEntity.clientId} 
					</if>
				</if>
				<!-- 时间段条件 -->
				<if test="pageFilter.property != null and pageFilter.startTime != null">
					<![CDATA[
					 and ${pageFilter.property} >= #{pageFilter.startTime}
					]]>
				</if>
				<if test="pageFilter.property != null and pageFilter.endTime != null">
					<![CDATA[
					 and ${pageFilter.property} <= #{pageFilter.endTime}
					]]>
				</if>
			</where>
		</if>
		
		<!-- 排序 --> 
		<if test="order != null">
			<if test="order.property != null and order.direction != null">
				order by ${order.property} ${order.direction} 
			</if>
		</if>
		
	</select>
	
</mapper>