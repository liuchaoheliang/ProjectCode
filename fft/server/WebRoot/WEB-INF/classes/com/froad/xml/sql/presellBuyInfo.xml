<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="presellBuyInfo">
	<typeAlias alias="presellBuyInfo" type="com.froad.CB.po.PresellBuyInfo" />	
	<resultMap class="presellBuyInfo" id="presellBuyInfoResult">
		<result property="id" column="id" jdbcType="INTEGER"/>
		<result property="memberCode" column="member_code" jdbcType="VARCHAR"/>
		<result property="totalGoodsNum" column="total_goods_num" jdbcType="VARCHAR"/>
		<result property="presellDeliveryId" column="presell_delivery_id" jdbcType="INTEGER"/>
		<result property="presellDelivery" column="presell_delivery_id" select="presellDelivery.getById"/>
		<result property="goodsPresellRackId" column="goods_presell_rack_id" jdbcType="INTEGER"/>
		<result property="goodsPresellRack" column="goods_presell_rack_id" select="goodsPresellRack.selectByPrimaryKey"/>
		<result property="transId" column="trans_id" jdbcType="INTEGER"/>
		<result property="createTime" column="create_time" jdbcType="VARCHAR"/>
		<result property="updateTime" column="update_time" jdbcType="VARCHAR"/>		
	</resultMap>
		
	<insert id="insert" parameterClass="presellBuyInfo">
		insert into presell_buy_info (member_code,total_goods_num,presell_delivery_id,goods_presell_rack_id,trans_id,create_time,update_time) values(
			#memberCode#,#totalGoodsNum#,#presellDeliveryId#,#goodsPresellRackId#,#transId#,
			DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s"),
			DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s")
		)		
		<selectKey keyProperty="id" resultClass="int">
			select last_insert_id() as id
		</selectKey>
	</insert>
	
	<update id="updateById" parameterClass="presellBuyInfo" >
		update presell_buy_info set update_time=DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s")
		<dynamic prepend="">
			<isNotEmpty property="memberCode" prepend=",">
				member_code=#memberCode#
			</isNotEmpty>
			<isNotEmpty property="totalGoodsNum" prepend=",">
				total_goods_num=#totalGoodsNum#
			</isNotEmpty>	
			<isNotEmpty property="presellDeliveryId" prepend=",">
				presell_delivery_id=#presellDeliveryId#
			</isNotEmpty>	
			<isNotEmpty property="goodsPresellRackId" prepend=",">
				goods_presell_rack_id=#goodsPresellRackId#
			</isNotEmpty>		
			<isNotEmpty property="transId" prepend=",">
				trans_id=#transId#
			</isNotEmpty>		
		</dynamic>		
			where id=#id#	
	</update>
	
	<select id="getById" parameterClass="java.lang.Integer" resultMap="presellBuyInfoResult">
		select * from presell_buy_info where id=#id#	
	</select>
	
	<select id="getByConditions" parameterClass="presellBuyInfo" resultMap="presellBuyInfoResult">
		select * from presell_buy_info 
		<dynamic prepend="where">
			<isNotEmpty property="id" prepend=",">
				id=#id#
			</isNotEmpty>
			<isNotEmpty property="memberCode" prepend=",">
				member_code=#memberCode#
			</isNotEmpty>
			<isNotEmpty property="totalGoodsNum" prepend=",">
				total_goods_num=#totalGoodsNum#
			</isNotEmpty>	
			<isNotEmpty property="presellDeliveryId" prepend=",">
				presell_delivery_id=#presellDeliveryId#
			</isNotEmpty>	
			<isNotEmpty property="goodsPresellRackId" prepend=",">
				goods_presell_rack_id=#goodsPresellRackId#
			</isNotEmpty>		
			<isNotEmpty property="transId" prepend=",">
				trans_id=#transId#
			</isNotEmpty>			
		</dynamic>	
	</select>	
	
	<select id="getByTransId" parameterClass="java.util.List" resultMap="presellBuyInfoResult">
		select * from presell_buy_info where trans_id in 	      		
		<iterate open="(" conjunction="," close=")">
	      		#stateList[]#
	     </iterate>
	</select>
	
	
</sqlMap>