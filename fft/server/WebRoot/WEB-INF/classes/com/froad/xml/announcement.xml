<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="announcement">
	<typeAlias alias="announcement" type="com.froad.CB.po.announcement.Announcement" />
	
	<resultMap class="announcement" id="announcementResult">
		<result property="id" column="id"/>
		<result property="title" column="title"/>
		<result property="content" column="content"/>
		<result property="releaseDate" column="release_date"/>
		<result property="endDate" column="end_date"/>
		<result property="type" column="type"/>
		<result property="important" column="important"/>
		<result property="releaser" column="releaser"/>
		<result property="state" column="state"/>
		<result property="createTime" column="create_time"/>
		<result property="updateTime" column="update_time"/>
		<result property="remark" column="remark"/>
	</resultMap>
		
	<!-- 增加公告 -->	
	<insert id="insert" parameterClass="announcement">
		insert into announcement
		(id,title,content,release_date,end_date,type,important,releaser,state,create_time,update_time,remark) 
		values
		(#id#,#title#,#content#,#releaseDate#,#endDate#,#type#,#important#,#releaser#,#state#,DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s"),DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s"),#remark#)
		<selectKey keyProperty="id" resultClass="int">
			select last_insert_id() as id
		</selectKey>
	</insert>
	
	<!-- 根据ID 查找公告 -->
	<select id="getAnnouncementById" parameterClass="java.lang.Integer" resultMap="announcementResult">
		select * from announcement where id=#id#
	</select>
	
	<!-- 查询启用的公告 根据等级排序 -->
	<select id="getAnnouncementOrderByImportant" resultMap="announcementResult">
		select * from announcement where state='30' order by important asc, create_time desc
	</select>
		
	<update id="updateById" parameterClass="announcement" >
	    update announcement set update_time = DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s")
	    <dynamic prepend="" >
	      <isNotEmpty prepend="," property="title" >
	        title = #title:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="," property="content" >
	        content = #content:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="," property="releaseDate" >
	        release_date = #releaseDate:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="," property="endDate" >
	        end_date = #endDate:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="," property="type" >
	        type = #type:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="," property="important" >
	        important = #important:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="," property="state" >
	        state = #state:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="," property="remark" >
	        remark = #remark:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="," property="releaser" >
	        releaser = #releaser:LONGVARCHAR#
	      </isNotEmpty>
	    </dynamic>
	    where id = #id:INTEGER#
	  </update>
	
	 <!-- 分页 查询公告  -->
    <select id="getByPager"  parameterClass="announcement" resultMap="announcementResult">
    	SELECT * FROM announcement
    	<dynamic prepend="where">
    	  <isNotEmpty prepend="and" property="id" >
            id = #id#
      	  </isNotEmpty>
	      <isNotEmpty prepend="and" property="title" >
	        title like concat('%',#title#,'%')
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="releaseDate" >
	        release_date = #releaseDate:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="endDate" >
	        end_date = #endDate:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="type" >
	        type = #type:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="important" >
	        important = #important:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="state" >
	        state = #state:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="releaser" >
	        releaser = #releaser:LONGVARCHAR#
	      </isNotEmpty>
		  <isNotEmpty property="beginTime">
	    	<isNotEmpty property="endTime" prepend="and">
	    		create_time between #beginTime# and #endTime#
	    	</isNotEmpty>
	      </isNotEmpty>
	    </dynamic>
	    order by important asc, update_time desc limit #startRow#,#pageSize#
    </select>
    
    <select id="getByPagerCount"  parameterClass="announcement" resultClass="java.lang.Integer">
    	SELECT count(*) FROM announcement
    	<dynamic prepend="where">
    	  <isNotEmpty prepend="and" property="id" >
            id = #id#
      	  </isNotEmpty>
	      <isNotEmpty prepend="and" property="title" >
	        title like concat('%',#title#,'%')
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="releaseDate" >
	        release_date = #releaseDate:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="endDate" >
	        end_date = #endDate:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="type" >
	        type = #type:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="important" >
	        important = #important:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="state" >
	        state = #state:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="releaser" >
	        releaser = #releaser:LONGVARCHAR#
	      </isNotEmpty>
		  <isNotEmpty property="beginTime">
	    	<isNotEmpty property="endTime" prepend="and">
	    		create_time between #beginTime# and #endTime#
	    	</isNotEmpty>
	      </isNotEmpty>
	    </dynamic>
    </select>
    
</sqlMap>