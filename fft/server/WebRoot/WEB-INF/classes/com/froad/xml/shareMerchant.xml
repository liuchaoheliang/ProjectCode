<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="shareMerchant">
 <typeAlias alias="shareMerchant" type="com.froad.CB.po.merchant.ShareMerchant"/>

  <resultMap id="ShareMerchantResult" class="shareMerchant" >
    <result column="id" property="id" jdbcType="INTEGER" />
    <result column="user_id" property="userId" jdbcType="VARCHAR" />
    <result column="merchant_id" property="merchantId" jdbcType="VARCHAR" />
    <result column="share_mobile" property="shareMobile" jdbcType="VARCHAR" />
    <result column="share_content" property="shareContent" jdbcType="VARCHAR" />
    <result column="state" property="state" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="VARCHAR" />
    <result column="update_time" property="updateTime" jdbcType="VARCHAR" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
  </resultMap>
  
  <select id="selectByPrimaryKey" resultMap="ShareMerchantResult" parameterClass="java.lang.Integer" >
    select * from share_merchant where id = #id#
  </select>
  
  <select id="getByUserId" resultMap="ShareMerchantResult" parameterClass="string">
  	select * from share_merchant where user_id=#value# order by create_time desc
  </select>
  
  <delete id="deleteByPrimaryKey" parameterClass="java.lang.Integer" >
        delete from share_merchant where id = #id:INTEGER#
  </delete>
  
  <insert id="insert" parameterClass="shareMerchant" >
      insert into share_merchant (id, user_id, merchant_id, share_mobile, share_content, state,
      create_time, update_time, remark)values(#id:INTEGER#, #userId:VARCHAR#, 
      #merchantId:VARCHAR#, #shareMobile:VARCHAR#,#shareContent:VARCHAR#,
      #state:VARCHAR#, DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s"), DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s"),#remark:VARCHAR#)
      <selectKey keyProperty="id" resultClass="int">
      	select last_insert_id() as id
      </selectKey>
  </insert>
  
  <update id="updateStateById" parameterClass="java.util.HashMap">
  	update share_merchant set state=#state#,update_time = DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s") where id=#id#
  </update>
  
  <update id="updateById" parameterClass="shareMerchant" >
    update share_merchant set update_time =DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s")
    <dynamic prepend="" >
      <isNotEmpty prepend="," property="userId" >
        user_id = #userId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="," property="merchantId" >
        merchant_id = #merchantId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="," property="shareMobile" >
        share_mobile = #shareMobile:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="," property="shareContent" >
        share_content = #shareContent:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="," property="state" >
        state = #state:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="," property="remark" >
        remark = #remark:VARCHAR#
      </isNotEmpty>
    </dynamic>
    where id = #id:INTEGER#
  </update>
  
  <!-- 分页查询分享信息 -->
  <select id="getByPager" parameterClass="shareMerchant" resultMap="ShareMerchantResult">
  	select * from share_merchant
  	<dynamic prepend="where">
  	  <isNotEmpty prepend="and" property="id" >
        id = #id#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="userId" >
        user_id = #userId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="merchantId" >
        merchant_id = #merchantId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="shareMobile" >
        share_mobile = #shareMobile:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="state" >
        state = #state:VARCHAR#
      </isNotEmpty>
      <isNotEmpty property="beginTime">
    	<isNotEmpty property="endTime" prepend="and">
    		create_time between #beginTime# and #endTime#
    	</isNotEmpty>
      </isNotEmpty>
    </dynamic>
    order by create_time desc limit #startRow#,#pageSize#
  </select>
  
  <select id="getByPagerCount" parameterClass="shareMerchant" resultClass="java.lang.Integer">
  	select count(*) from share_merchant
  	<dynamic prepend="where">
  	  <isNotEmpty prepend="and" property="id" >
        id = #id#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="userId" >
        user_id = #userId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="merchantId" >
        merchant_id = #merchantId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="shareMobile" >
        share_mobile = #shareMobile:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="state" >
        state = #state:VARCHAR#
      </isNotEmpty>
      <isNotEmpty property="beginTime">
    	<isNotEmpty property="endTime" prepend="and">
    		create_time between #beginTime# and #endTime#
    	</isNotEmpty>
      </isNotEmpty>
    </dynamic>
  </select>
</sqlMap>