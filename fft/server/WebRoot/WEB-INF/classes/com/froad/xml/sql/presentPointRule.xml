<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="presentPointRule">
	<typeAlias alias="presentPointRule" type="com.froad.CB.po.PresentPointRule" />
	
	<resultMap class="presentPointRule" id="presentPointRuleResult">
		<result property="id" column="id" jdbcType="INTEGER"/>
		<result property="goodExchangeRackId" column="good_exchange_rack_id" jdbcType="VARCHAR"/>
		<result property="goodName" column="good_name" jdbcType="VARCHAR"/>
		<result property="state" column="state" jdbcType="INTEGER"/>
		<result property="pointValue" column="point_value" jdbcType="VARCHAR" />
		<result property="activeTime" column="active_time" jdbcType="VARCHAR"/>		
		<result property="expireTime" column="expire_time" jdbcType="VARCHAR"/>
		<result property="createTime" column="create_time" jdbcType="VARCHAR"/>
		<result property="updateTime" column="update_time" jdbcType="VARCHAR"/>
	</resultMap>
		
	<insert id="insert" parameterClass="presentPointRule">
		insert into present_point_rule(good_exchange_rack_id,good_name,state,point_value,active_time,expire_time,create_time,update_time) values(
			#goodExchangeRackId#,#goodName#,#state#,#pointValue#,#activeTime#,#expireTime#,
			DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s"),
			DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s")
		)		
		<selectKey keyProperty="id" resultClass="int">
			select last_insert_id() as id
		</selectKey>
	</insert>
	
	<update id="updateById" parameterClass="presentPointRule" >
		update present_point_rule set update_time=DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s")		
			<isNotEmpty property="state" prepend=",">
				state=#state#
			</isNotEmpty>
			where id=#id#	
	</update>
	
	<select id="getById" parameterClass="java.lang.Integer" resultMap="presentPointRuleResult">
		select * from present_point_rule where id=#id#	
	</select>
	
	<select id="getByCondtions" parameterClass="presentPointRule" resultMap="presentPointRuleResult">
		select * from present_point_rule 
		<dynamic prepend="where">
			<isNotEmpty property="id" prepend="and">
				id=#id#
			</isNotEmpty>
			<isNotEmpty property="goodExchangeRackId" prepend="and">
				good_exchange_rack_id=#goodExchangeRackId#
			</isNotEmpty>
			<isNotEmpty property="state" prepend="and">
				state=#state#
			</isNotEmpty>
			<isNotEmpty property="goodName" prepend="and">
				good_name like concat('%',#goodName#,'%')
			</isNotEmpty>
		</dynamic>	
	</select>
	
	<select id="getByPresentPointRulePager" parameterClass="presentPointRule" resultMap="presentPointRuleResult">
		select * from present_point_rule 
		<dynamic prepend="where">
			<isNotEmpty property="id" prepend="and">
				id=#id#
			</isNotEmpty>
			<isNotEmpty property="goodName" prepend="and">
				good_name like concat('%',#goodName#,'%')
			</isNotEmpty>
			<isNotEmpty property="goodExchangeRackId" prepend="and">
				good_exchange_rack_id=#goodExchangeRackId#
			</isNotEmpty>
			<isNotEmpty property="state" prepend="and">
				state=#state#
			</isNotEmpty>
		</dynamic>		
		    <![CDATA[ 
            	order by $orderBy$ $orderType$ 
            	limit #startRow#,#pageSize#  
            ]]> 
	</select>
	<select id="getByPresentPointRulePagerCount" parameterClass="presentPointRule" resultClass="java.lang.Integer">
		select count(*) from present_point_rule  
		<dynamic prepend="where">
			<isNotEmpty property="id" prepend="and">
				id=#id#
			</isNotEmpty>
			<isNotEmpty property="goodName" prepend="and">
				good_name like concat('%',#goodName#,'%')
			</isNotEmpty>
			<isNotEmpty property="goodExchangeRackId" prepend="and">
				good_exchange_rack_id=#goodExchangeRackId#
			</isNotEmpty>
			<isNotEmpty property="state" prepend="and">
				state=#state#
			</isNotEmpty>
		</dynamic>		
	</select>
	
	<select id="getByRackId" parameterClass="java.lang.String" resultMap="presentPointRuleResult">
		select * from present_point_rule where state='1' and good_exchange_rack_id=#RackId#
	</select>

</sqlMap>