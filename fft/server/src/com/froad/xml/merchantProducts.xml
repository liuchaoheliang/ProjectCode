<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="merchantProducts" >
	
	<typeAlias alias="merchantProduct" type="com.froad.CB.po.merchant.MerchantProduct"/>

	<resultMap id="MerchantProductResult" class="merchantProduct" >
	  <result column="id" property="id" jdbcType="INT" />
	  <result column="Merchant_id" property="MerchantId" jdbcType="VARCHAR" />
	  <result column="photo_url" property="photoUrl" jdbcType="VARCHAR" />
	  <result column="photo_format_1" property="photoFormat1" jdbcType="VARCHAR" />
	  <result column="photo_format_2" property="photoFormat2" jdbcType="VARCHAR" />
	  <result column="array" property="array" jdbcType="VARCHAR" />
	  <result column="point_rate" property="pointRate" jdbcType="VARCHAR" />
	  <result column="preferential_rate" property="preferentialRate" jdbcType="VARCHAR" />
	  <result column="product_priority" property="productPriority" jdbcType="VARCHAR" />
	  <result column="price" property="price" jdbcType="VARCHAR" />   
	  <result column="txt_1" property="txt1" jdbcType="VARCHAR" />
	  <result column="txt_2" property="txt2" jdbcType="VARCHAR" />
	  <result column="txt_3" property="txt3" jdbcType="VARCHAR" />
	  <result column="state" property="state" jdbcType="VARCHAR" />
	  <result column="create_time" property="createTime" jdbcType="VARCHAR" />
	  <result column="update_time" property="updateTime" jdbcType="VARCHAR" />
	  <result column="remark" property="remark" jdbcType="VARCHAR" />
	</resultMap>
	
	<select id="selectByPrimaryKey" resultMap="MerchantProductResult" parameterClass="java.lang.Integer" >
	  select * from merchant_products where id = #id#
	</select>
	
	<!-- 按商户查询商户商品 -->
	<select id="selectByMerchantId" resultMap="MerchantProductResult" parameterClass="java.lang.String" >
	  select * from merchant_products where Merchant_id = #value# 
	</select>
	
	<!-- 查询商户商品 -->
	<select id="selectByMerchantProductId" resultMap="MerchantProductResult" parameterClass="java.lang.String" >
	  select * from merchant_products where Merchant_id = #value# and state = '30'
	</select>
	
	<delete id="deleteByPrimaryKey" parameterClass="merchantProduct" >
	    delete from merchant_products where id = #id:INT#
	</delete>
	
	<!-- 按主键逻辑删除商户产品 -->
	<update id="deleteStateByPrimaryKey" parameterClass="merchantProduct" >
	     update merchant_products a 
	     set a.state = '50',
	     	a.update_time = DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s")
	     where id = #id:INT#
	</update>
	
	<insert id="insert" parameterClass="merchantProduct" >
	   insert into merchant_products (id, Merchant_id, photo_url, photo_format_1, photo_format_2,
	   array, txt_1, txt_2, txt_3,point_rate,preferential_rate,price,product_priority, state, create_time, update_time, remark)
	   values(#id:INT#, #MerchantId:VARCHAR#, #photoUrl:VARCHAR#, #photoFormat1:VARCHAR#,
	    #photoFormat2:VARCHAR#, #array:VARCHAR#, #txt1:VARCHAR#, #txt2:VARCHAR#, #txt3:VARCHAR#,#pointRate:VARCHAR#, #preferentialRate:VARCHAR#, #price:VARCHAR#,#productPriority:VARCHAR#,
	    #state:VARCHAR#, DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s"), DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s"), #remark:VARCHAR#)
	    <selectKey resultClass="int" keyProperty="id">
	       select last_insert_id() as id
	    </selectKey>
	</insert>
	
	<update id="updateByPrimaryKeySelective" parameterClass="merchantProduct" >
	      update merchant_products set update_time = DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s")
	  <dynamic prepend="" >
	    <isNotEmpty prepend="," property="MerchantId" >
	      Merchant_id = #MerchantId:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="photoUrl" >
	      photo_url = #photoUrl:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="photoFormat1" >
	      photo_format_1 = #photoFormat1:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="photoFormat2" >
	      photo_format_2 = #photoFormat2:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="array" >
	      array = #array:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="txt1" >
	      txt_1 = #txt1:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="txt2" >
	      txt_2 = #txt2:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="txt3" >
	      txt_3 = #txt3:VARCHAR#
	    </isNotEmpty>     
	    <isNotEmpty prepend="," property="pointRate" >
	      point_rate= #pointRate:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="preferentialRate" >
	    	preferential_rate = #preferentialRate:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="price" >
	    	price = #price:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="productPriority" >
	    	product_priority = #productPriority:VARCHAR#
	    </isNotEmpty>     
	    <isNotEmpty prepend="," property="state" >
	      state = #state:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="remark" >
	      remark = #remark:VARCHAR#
	    </isNotEmpty>
	  </dynamic>
	  where id = #id:INT#
	</update>
	
	<update id="updateByMerchantIdSelective" parameterClass="merchantProduct" >
	      update merchant_products set update_time = DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s")
	  <dynamic prepend="" >
	    <isNotEmpty prepend="," property="photoUrl" >
	      photo_url = #photoUrl:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="photoFormat1" >
	      photo_format_1 = #photoFormat1:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="photoFormat2" >
	      photo_format_2 = #photoFormat2:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="array" >
	      array = #array:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="txt1" >
	      txt_1 = #txt1:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="txt2" >
	      txt_2 = #txt2:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="txt3" >
	      txt_3 = #txt3:VARCHAR#
	    </isNotEmpty>     
	    <isNotEmpty prepend="," property="pointRate" >
	      point_rate= #pointRate:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="preferentialRate" >
	    	preferential_rate = #preferentialRate:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="price" >
	    	price = #price:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="productPriority" >
	    	product_priority = #productPriority:VARCHAR#
	    </isNotEmpty>     
	    <isNotEmpty prepend="," property="state" >
	      state = #state:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="remark" >
	      remark = #remark:VARCHAR#
	    </isNotEmpty>
	  </dynamic>
	  WHERE Merchant_id = #MerchantId:VARCHAR#
	</update>
	
	<!-- 根据商户ID查询商户产品  (单表查询不用这个，效率差) 分页 -->
    <select id="findMerchantProductsByPager"  resultMap="MerchantProductResult" parameterClass="merchantProduct">
    	<![CDATA[ SELECT /*+ ordered use_nl(t1 t2)*/
        			*
         	FROM        				 
	    	  	(SELECT AA.rid as rid
			   	   FROM
				        (SELECT a.id as rid
				          	FROM merchant_products a
				          	WHERE 	(a.state = '30' or a.state = '40' or a.state = '50')
			 ]]>
				          <dynamic>
				            <isNotEmpty prepend="AND" property="MerchantId">
				                <![CDATA[  a.Merchant_id = #MerchantId:VARCHAR# ]]>
				            </isNotEmpty>
				            <isNotEmpty prepend="and" property="photoUrl" >
						      <![CDATA[  a.photo_url = #photoUrl:VARCHAR#]]>
						    </isNotEmpty>
						    <isNotEmpty prepend="and" property="photoFormat1" >
						      <![CDATA[ a.photo_format_1 = #photoFormat1:VARCHAR#]]>
						    </isNotEmpty>
						    <isNotEmpty prepend="and" property="photoFormat2" >
						     <![CDATA[  a.photo_format_2 = #photoFormat2:VARCHAR#]]>
						    </isNotEmpty>
						    <isNotEmpty prepend="and" property="array" >
						     <![CDATA[  a.array = #array:VARCHAR#]]>
						    </isNotEmpty>
						    <isNotEmpty prepend="and" property="txt1" >
						     <![CDATA[  a.txt_1 = #txt1:VARCHAR#]]>
						    </isNotEmpty>
						    <isNotEmpty prepend="and" property="txt2" >
						     <![CDATA[  a.txt_2 = #txt2:VARCHAR#]]>
						    </isNotEmpty>
						    <isNotEmpty prepend="and" property="txt3" >
						      <![CDATA[ a.txt_3 = #txt3:VARCHAR#]]>
						    </isNotEmpty>
						    <isNotEmpty prepend="and" property="pointRate" >
						      <![CDATA[ a.point_rate= #pointRate:VARCHAR#]]>
						    </isNotEmpty>
						    <isNotEmpty prepend="and" property="preferentialRate" >
						    	<![CDATA[ a.preferential_rate = #preferentialRate:VARCHAR#]]>
						    </isNotEmpty>
						    <isNotEmpty prepend="and" property="price" >
						    	<![CDATA[ a.price = #price:VARCHAR#]]>
						    </isNotEmpty>
						    <isNotEmpty prepend="and" property="productPriority" >
						    	<![CDATA[ a.product_priority = #productPriority:VARCHAR#]]>
						    </isNotEmpty> 
						    <isNotEmpty prepend="and" property="createTime" >
						      <![CDATA[ a.create_time = #createTime:VARCHAR#]]>
						    </isNotEmpty>
						    <isNotEmpty prepend="and" property="updateTime" >
						      <![CDATA[ a.update_time = #updateTime:VARCHAR#]]>
						    </isNotEmpty>
						    <isNotEmpty prepend="and" property="remark" >
						      <![CDATA[ a.remark = #remark:VARCHAR#]]>
						    </isNotEmpty> 
							<isNotEmpty property="beginTime">
				    			<isNotEmpty property="endTime" prepend="and">
				    				<![CDATA[ a.create_time between #beginTime# and #endTime#]]>
				    			</isNotEmpty>
				    		</isNotEmpty>
				          </dynamic>
	        <![CDATA[
				        	ORDER BY a.id DESC) AA
					limit #startRow#,#pageSize#) t1,merchant_products t2
			WHERE t1.rid=t2.id
		 	ORDER BY t2.$orderBy$ $orderType$		 
		 ]]>
    </select>
    <!-- 根据商户ID查询商户产品 分页 COUNT -->
    <select id="findMerchantProductsByPagerCount" parameterClass="merchantProduct" resultClass="java.lang.Integer">
        <![CDATA[ 
        	SELECT  count(*) FROM merchant_products a
        	WHERE (a.state = '30' or a.state = '40' or a.state = '50')
         ]]>
          	<dynamic>
             	<isNotEmpty prepend="AND" property="MerchantId">
	                <![CDATA[  a.Merchant_id = #MerchantId:VARCHAR# ]]>
	            </isNotEmpty>
	            <isNotEmpty prepend="and" property="photoUrl" >
			      <![CDATA[  a.photo_url = #photoUrl:VARCHAR#]]>
			    </isNotEmpty>
			    <isNotEmpty prepend="and" property="photoFormat1" >
			      <![CDATA[ a.photo_format_1 = #photoFormat1:VARCHAR#]]>
			    </isNotEmpty>
			    <isNotEmpty prepend="and" property="photoFormat2" >
			     <![CDATA[  a.photo_format_2 = #photoFormat2:VARCHAR#]]>
			    </isNotEmpty>
			    <isNotEmpty prepend="and" property="array" >
			     <![CDATA[  a.array = #array:VARCHAR#]]>
			    </isNotEmpty>
			    <isNotEmpty prepend="and" property="txt1" >
			     <![CDATA[  a.txt_1 = #txt1:VARCHAR#]]>
			    </isNotEmpty>
			    <isNotEmpty prepend="and" property="txt2" >
			     <![CDATA[  a.txt_2 = #txt2:VARCHAR#]]>
			    </isNotEmpty>
			    <isNotEmpty prepend="and" property="txt3" >
			      <![CDATA[ a.txt_3 = #txt3:VARCHAR#]]>
			    </isNotEmpty>
			    <isNotEmpty prepend="and" property="pointRate" >
			      <![CDATA[ a.point_rate= #pointRate:VARCHAR#]]>
			    </isNotEmpty>
			    <isNotEmpty prepend="and" property="preferentialRate" >
			    	<![CDATA[ a.preferential_rate = #preferentialRate:VARCHAR#]]>
			    </isNotEmpty>
			    <isNotEmpty prepend="and" property="price" >
			    	<![CDATA[ a.price = #price:VARCHAR#]]>
			    </isNotEmpty>
			    <isNotEmpty prepend="and" property="productPriority" >
			    	<![CDATA[ a.product_priority = #productPriority:VARCHAR#]]>
			    </isNotEmpty> 
			    <isNotEmpty prepend="and" property="createTime" >
			      <![CDATA[ a.create_time = #createTime:VARCHAR#]]>
			    </isNotEmpty>
			    <isNotEmpty prepend="and" property="updateTime" >
			      <![CDATA[ a.update_time = #updateTime:VARCHAR#]]>
			    </isNotEmpty>
			    <isNotEmpty prepend="and" property="remark" >
			      <![CDATA[ a.remark = #remark:VARCHAR#]]>
			    </isNotEmpty> 
			    <isNotEmpty property="beginTime">
	    			<isNotEmpty property="endTime" prepend="and">
	    				<![CDATA[ a.create_time between #beginTime# and #endTime#]]>
	    			</isNotEmpty>
	    		</isNotEmpty>
          	</dynamic>
    </select>
	
	
	<select id="selectMerchantProducts" resultMap="MerchantProductResult" parameterClass="merchantProduct">
	 select * from merchant_products
	  <dynamic prepend="where" >
	  <isNotEmpty prepend="and" property="id" >
	      id = #id:INT#
	    </isNotEmpty>
	    <isNotEmpty prepend="and" property="MerchantId" >
	      Merchant_id = #MerchantId:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="and" property="photoUrl" >
	      photo_url = #photoUrl:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="and" property="photoFormat1" >
	      photo_format_1 = #photoFormat1:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="and" property="photoFormat2" >
	      photo_format_2 = #photoFormat2:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="and" property="array" >
	      array = #array:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="and" property="txt1" >
	      txt_1 = #txt1:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="and" property="txt2" >
	      txt_2 = #txt2:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="and" property="txt3" >
	      txt_3 = #txt3:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="and" property="pointRate" >
	      point_rate= #pointRate:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="and" property="preferentialRate" >
	    	preferential_rate = #preferentialRate:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="and" property="price" >
	    	price = #price:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="and" property="productPriority" >
	    	product_priority = #productPriority:VARCHAR#
	    </isNotEmpty> 
	    <isNotEmpty prepend="and" property="state" >
	      state = #state:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="and" property="createTime" >
	      create_time = #createTime:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="and" property="updateTime" >
	      update_time = #updateTime:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="and" property="remark" >
	      remark = #remark:VARCHAR#
	    </isNotEmpty>
	  </dynamic>
	</select>
  
   <!-- 分页 查询商品  -->
    <select id="getMerchantProductByPager"  parameterClass="merchantProduct" resultMap="MerchantProductResult">
    	SELECT * FROM merchant_products
    	<dynamic prepend="where">
	    	<isNotEmpty prepend="and" property="id" >
		      id = #id:INT#
		    </isNotEmpty>
		    <isNotEmpty prepend="and" property="MerchantId" >
		      Merchant_id = #MerchantId:VARCHAR#
		    </isNotEmpty>
		    <isNotEmpty prepend="and" property="pointRate" >
		      point_rate= #pointRate:VARCHAR#
		    </isNotEmpty>
		    <isNotEmpty prepend="and" property="preferentialRate" >
		    	preferential_rate = #preferentialRate:VARCHAR#
		    </isNotEmpty>
		    <isNotEmpty prepend="and" property="price" >
		    	price = #price:VARCHAR#
		    </isNotEmpty>
		    <isNotEmpty prepend="and" property="productPriority" >
		    	product_priority = #productPriority:VARCHAR#
		    </isNotEmpty> 
		    <isNotEmpty prepend="and" property="state" >
		      state = #state:VARCHAR#
		    </isNotEmpty>
		    <isNotEmpty property="beginTime">
		    	<isNotEmpty property="endTime" prepend="and">
		    		create_time between #beginTime# and #endTime#
		    	</isNotEmpty>
      		</isNotEmpty>
	    </dynamic>
	    order by $orderBy$ $orderType$ limit #startRow#,#pageSize#
    </select>
    
    <select id="getMerchantProductByPagerCount"  parameterClass="merchantProduct" resultClass="java.lang.Integer">
    	SELECT count(*) FROM merchant_products
    	<dynamic prepend="where">
	    	<isNotEmpty prepend="and" property="id" >
		      id = #id:INT#
		    </isNotEmpty>
		    <isNotEmpty prepend="and" property="MerchantId" >
		      Merchant_id = #MerchantId:VARCHAR#
		    </isNotEmpty>
		    <isNotEmpty prepend="and" property="pointRate" >
		      point_rate= #pointRate:VARCHAR#
		    </isNotEmpty>
		    <isNotEmpty prepend="and" property="preferentialRate" >
		    	preferential_rate = #preferentialRate:VARCHAR#
		    </isNotEmpty>
		    <isNotEmpty prepend="and" property="price" >
		    	price = #price:VARCHAR#
		    </isNotEmpty>
		    <isNotEmpty prepend="and" property="productPriority" >
		    	product_priority = #productPriority:VARCHAR#
		    </isNotEmpty> 
		    <isNotEmpty prepend="and" property="state" >
		      state = #state:VARCHAR#
		    </isNotEmpty>
		    <isNotEmpty property="beginTime">
		    	<isNotEmpty property="endTime" prepend="and">
		    		create_time between #beginTime# and #endTime#
		    	</isNotEmpty>
      		</isNotEmpty>
	    </dynamic>
    </select>  
</sqlMap>