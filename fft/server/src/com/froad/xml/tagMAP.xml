<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="tagMAP">
	
	<typeAlias alias="tagMAP" type="com.froad.CB.po.tag.TagMAP"/>

	<resultMap id="TagMAPResult" class="tagMAP" >
	  <result column="id" property="id" jdbcType="INT" />
	  <result column="Merchant_id" property="merchantId" jdbcType="VARCHAR" />
	  <result column="Merchant_id" property="merchantName" select="merchant.getMerchantNameById"/>
	  <result column="site_value" property="siteValue" jdbcType="VARCHAR" />
	  <result column="state" property="state" jdbcType="VARCHAR" />
	  <result column="create_time" property="createTime" jdbcType="VARCHAR" />
	  <result column="update_time" property="updateTime" jdbcType="VARCHAR" />
	  <result column="remark" property="remark" jdbcType="VARCHAR" />
	  <result column="tag_classify_a_id" property="tagClassifyAId" jdbcType="VARCHAR" />
	  <result column="tag_classify_b_id" property="tagClassifyBId" jdbcType="VARCHAR" />
	  <result column="tag_district_a_id" property="tagDistrictAId" jdbcType="VARCHAR" />
	  <result column="tag_district_b_id" property="tagDistrictBId" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="TagMAPResultWithJoinSelect" class="tagMAP" >
	  <result column="id" property="id" jdbcType="INT" />
	  <result column="Merchant_id" property="merchantId" jdbcType="VARCHAR" />
	  <result column="site_value" property="siteValue" jdbcType="VARCHAR" />
	  <result column="state" property="state" jdbcType="VARCHAR" />
	  <result column="create_time" property="createTime" jdbcType="VARCHAR" />
	  <result column="update_time" property="updateTime" jdbcType="VARCHAR" />
	  <result column="remark" property="remark" jdbcType="VARCHAR" />
	  
	  <result column="tag_classify_a_id" property="tagClassifyA" select="tagClassifyA.selectByPrimaryKey" />
	  <result column="tag_classify_b_id" property="tagClassifyB" select="tagClassifyB.selectByPrimaryKey" />
	  <result column="tag_district_a_id" property="tagDistrictA" select="tagDistrictA.selectByPrimaryKey"/>
	  <result column="tag_district_b_id" property="tagDistrictB" select="tagDistrictB.selectByPrimaryKey" />
	</resultMap>
	
	<select id="getTagMapsByMerchantId" parameterClass="string" resultMap="TagMAPResult">
		select * from tag_map where Merchant_id=#value#
	</select>
	
	<select id="selectTagsByMerchantId" resultMap="TagMAPResultWithJoinSelect" parameterClass="java.lang.String">
		select * from tag_map where Merchant_id=#merchantId:VARCHAR#
	</select>
	
	<select id="getTopTagMaps" resultMap="TagMAPResult">
		select * from tag_map order by create_time limit 30
	</select>
	
	<select id="getTagMapsByMerchantName" parameterClass="string" resultMap="TagMAPResult">
		select * from tag_map where Merchant_id in(
			select id from merchant where 
			M_company_full_name like concat('%',#value#,'%'))
	</select>
	
	<select id="selectByPrimaryKey" resultMap="TagMAPResult" parameterClass="java.lang.Integer" >
	    select * from tag_map where id = #id#
	</select>
	
	<delete id="deleteByPrimaryKey" parameterClass="java.lang.Integer" >
	      delete from tag_map where id = #id#
	</delete>
	
	<insert id="insert" parameterClass="tagMAP" >
		insert into tag_map (id, Merchant_id, site_value, state, create_time, update_time, remark,
		tag_classify_a_id, tag_classify_b_id, tag_district_a_id, tag_district_b_id)
		values (#id:INT#, #merchantId:VARCHAR#, #siteValue:VARCHAR#, #state:VARCHAR#,
		DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s"), DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s"), #remark:VARCHAR#, #tagClassifyAId:VARCHAR#,
		#tagClassifyBId:VARCHAR#, #tagDistrictAId:VARCHAR#, #tagDistrictBId:VARCHAR#)
		<selectKey keyProperty="id" resultClass="int">
			select last_insert_id() as id
		</selectKey>
	</insert>
	
	<update id="updateById" parameterClass="tagMAP" >
	      update tag_map
	  <dynamic prepend="set" >
	    <isNotEmpty prepend="," property="merchantId" >
	      Merchant_id = #merchantId:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="siteValue" >
	      site_value = #siteValue:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="state" >
	      state = #state:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="createTime" >
	      create_time = #createTime:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="updateTime" >
	      update_time = #updateTime:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="remark" >
	      remark = #remark:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="tagClassifyAId" >
	      tag_classify_a_id = #tagClassifyAId:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="tagClassifyBId" >
	      tag_classify_b_id = #tagClassifyBId:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="tagDistrictAId" >
	      tag_district_a_id = #tagDistrictAId:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="," property="tagDistrictBId" >
	      tag_district_b_id = #tagDistrictBId:VARCHAR#
	    </isNotEmpty>
	  </dynamic>
	  where id = #id:INT#
	</update>
	
	<select id="selectTagMAPs" resultMap="TagMAPResult" parameterClass="tagMAP">
		select * from tag_map
	  <dynamic prepend="where" >
	   <isNotEmpty prepend="and" property="id" >
	     id = #id:INT#
	    </isNotEmpty>
	    <isNotEmpty prepend="and" property="merchantId" >
	      Merchant_id = #merchantId:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="and" property="siteValue" >
	      site_value = #siteValue:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="and" property="state" >
	      state = #state:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="and" property="createTime" >
	      create_time = #createTime:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="and" property="updateTime" >
	      update_time = #updateTime:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="and" property="remark" >
	      remark = #remark:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="and" property="tagClassifyAId" >
	      tag_classify_a_id = #tagClassifyAId:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="and" property="tagClassifyBId" >
	      tag_classify_b_id = #tagClassifyBId:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="and" property="tagDistrictAId" >
	      tag_district_a_id = #tagDistrictAId:VARCHAR#
	    </isNotEmpty>
	    <isNotEmpty prepend="and" property="tagDistrictBId" >
	      tag_district_b_id = #tagDistrictBId:VARCHAR#
	    </isNotEmpty>
	  </dynamic>
	</select>
	
	<insert id="insertBatch" parameterClass="java.util.List">
		insert into tag_map (id, Merchant_id, site_value, state, create_time, update_time, remark,
		tag_classify_a_id, tag_classify_b_id, tag_district_a_id, tag_district_b_id)
		values 
		<iterate conjunction =","> 
		(#[].id:INT#, #[].merchantId:VARCHAR#, #[].siteValue:VARCHAR#, #[].state:VARCHAR#,
		#[].createTime:VARCHAR#, #[].updateTime:VARCHAR#, #[].remark:VARCHAR#, #[].tagClassifyAId:VARCHAR#,
		#[].tagClassifyBId:VARCHAR#, #[].tagDistrictAId:VARCHAR#, #[].tagDistrictBId:VARCHAR#)
		</iterate>
	</insert>
</sqlMap>