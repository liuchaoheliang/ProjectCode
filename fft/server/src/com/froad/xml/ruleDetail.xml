<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="rule_detail" >

	<parameterMap class="com.froad.CB.po.RuleDetail" id="ruleDetailPara">
	<parameter property="id"  />
	<parameter property="ruleType"  />
	<parameter property="ruleId"  />
	<parameter property="remark"  />
	<parameter property="updateTime"  />
	<parameter property="createTime"  />
	<parameter property="state"  />
	<parameter property="description"  />
	<parameter property="endTime"  />
	<parameter property="startTime"  />
	<parameter property="intervalTime"  />
	
	<parameter property="paymentStartTime"  />
	<parameter property="formula"  />
	<parameter property="ruleDetailTempletId"  />
	
	<parameter property="ruleDetailType"  />
	</parameterMap>


  <resultMap id="abatorgenerated_RuleDetailResult" class="com.froad.CB.po.RuleDetail" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Wed Jan 30 18:03:53 CST 2013.
    -->
    <result column="id" property="id" jdbcType="INT" />
    <result column="rule_type" property="ruleType" jdbcType="VARCHAR" />
    <result column="rule_id" property="ruleId" jdbcType="INT" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="update_time" property="updateTime" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="VARCHAR" />
    <result column="state" property="state" jdbcType="VARCHAR" />
    <result column="description" property="description" jdbcType="VARCHAR" />
    <result column="end_time" property="endTime" jdbcType="VARCHAR" />
    <result column="start_time" property="startTime" jdbcType="VARCHAR" />
    <result column="interval_time" property="intervalTime" jdbcType="VARCHAR" />
    <result column="payment_start_time" property="paymentStartTime" jdbcType="VARCHAR" />
    <result column="formula" property="formula" jdbcType="VARCHAR" />
    <result column="rule_detail_templet_id" property="ruleDetailTempletId" jdbcType="INT" />
    <result column="rule_detail_type" property="ruleDetailType" jdbcType="VARCHAR" />
    																	
     <!--   <result column="rule_id" property="transRule" select="trans_rule.abatorgenerated_selectByPrimaryKey" />   -->
  <result column="rule_detail_templet_id" property="ruleDetailTemplet" select="rule_detail_templet.selectRuleDetailTempletById" />   
    
  </resultMap>
  
  
   <resultMap id="abatorgenerated_RuleDetailResult2" class="com.froad.CB.po.RuleDetail" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Wed Jan 30 18:03:53 CST 2013.
    -->
    <result column="id" property="id" jdbcType="INT" />
    <result column="rule_type" property="ruleType" jdbcType="VARCHAR" />
    <result column="rule_id" property="ruleId" jdbcType="INT" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="update_time" property="updateTime" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="VARCHAR" />
    <result column="state" property="state" jdbcType="VARCHAR" />
    <result column="description" property="description" jdbcType="VARCHAR" />
    <result column="end_time" property="endTime" jdbcType="VARCHAR" />
    <result column="start_time" property="startTime" jdbcType="VARCHAR" />
    <result column="interval_time" property="intervalTime" jdbcType="VARCHAR" />
    <result column="payment_start_time" property="paymentStartTime" jdbcType="VARCHAR" />
    <result column="formula" property="formula" jdbcType="VARCHAR" />
    <result column="rule_detail_templet_id" property="ruleDetailTempletId" jdbcType="INT" />
    <result column="rule_detail_type" property="ruleDetailType" jdbcType="VARCHAR" />
    																	
     <!--   <result column="rule_id" property="transRule" select="trans_rule.abatorgenerated_selectByPrimaryKey" />   -->
    <result column="ruleDetailTemplet_id" property="ruleDetailTemplet.id" jdbcType="INT" />
    <result column="ruleDetailTemplet_seq_no" property="ruleDetailTemplet.seqNo" jdbcType="VARCHAR" />
    <result column="ruleDetailTemplet_rule_type" property="ruleDetailTemplet.ruleType" jdbcType="VARCHAR" />
    <result column="ruleDetailTemplet_to_account_type" property="ruleDetailTemplet.toAccountType" jdbcType="VARCHAR" />
    <result column="ruleDetailTemplet_from_account_type" property="ruleDetailTemplet.fromAccountType" jdbcType="VARCHAR" />
    <result column="ruleDetailTemplet_remark" property="ruleDetailTemplet.remark" jdbcType="VARCHAR" />

    <result column="ruleDetailTemplet_state" property="ruleDetailTemplet.state" jdbcType="VARCHAR" />
    <result column="ruleDetailTemplet_description" property="ruleDetailTemplet.description" jdbcType="VARCHAR" />
    <result column="ruleDetailTemplet_param_of_formula_from" property="ruleDetailTemplet.paramOfFormulaFrom" jdbcType="VARCHAR" />
    <result column="ruleDetailTemplet_param_of_formula" property="ruleDetailTemplet.paramOfFormula" jdbcType="VARCHAR" />
    <result column="ruleDetailTemplet_settle_type" property="ruleDetailTemplet.settleType" jdbcType="VARCHAR" />
    <result column="ruleDetailTemplet_use_time" property="ruleDetailTemplet.useTime" jdbcType="VARCHAR" />
    <result column="ruleDetailTemplet_clazz_name" property="ruleDetailTemplet.clazzName" jdbcType="VARCHAR" />
    <result column="ruleDetailTemplet_detail_rule_formula_from" property="ruleDetailTemplet.detailRuleFormulaFrom" jdbcType="VARCHAR" />
    <result column="ruleDetailTemplet_calculate_type" property="ruleDetailTemplet.calculateType" jdbcType="VARCHAR" />
    <result column="ruleDetailTemplet_to_role" property="ruleDetailTemplet.toRole" jdbcType="VARCHAR" />
    <result column="ruleDetailTemplet_from_role" property="ruleDetailTemplet.fromRole" jdbcType="VARCHAR" />
    <result column="ruleDetailTemplet_rule_detail_type" property="ruleDetailTemplet.ruleDetailType" jdbcType="VARCHAR" />
     <result column="ruleDetailTemplet_formula_of_detail_rule" property="ruleDetailTemplet.formulaOfDetailRule" jdbcType="VARCHAR" />
     <result column="ruleDetailTemplet_rule_detail_category" property="ruleDetailTemplet.ruleDetailCategory" jdbcType="VARCHAR" />
     <result column="ruleDetailTemplet_detail_rule_formula_from_type" property="ruleDetailTemplet.detailRuleFormulaFromType" jdbcType="VARCHAR" />
     
  </resultMap>
  
  
  <select id="abatorgenerated_selectByPrimaryKey" resultMap="abatorgenerated_RuleDetailResult" parameterClass="com.froad.CB.po.RuleDetail" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Wed Jan 30 18:03:53 CST 2013.
    -->
    select id, rule_type, rule_id, remark, update_time, create_time, state, description, end_time,
      start_time, interval_time, payment_start_time, formula, rule_detail_templet_id,
      rule_detail_type
    from rule_detail
     where id = #id:INT#    
  </select>
  <delete id="abatorgenerated_deleteByPrimaryKey" parameterClass="com.froad.CB.po.RuleDetail" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Wed Jan 30 18:03:53 CST 2013.
    -->
    delete from rule_detail
    where id = #id:INT#
  </delete>
  
  <insert id="insertRuleDetails"  parameterClass="java.util.ArrayList" >
    insert into rule_detail (id, rule_type, rule_id, remark, update_time, create_time, state,
      description, end_time, start_time, interval_time, payment_start_time, formula,
      rule_detail_templet_id, rule_detail_type)
    values 
    <iterate conjunction="," >
    (#insertRuleDetailList[].id:INT#, #insertRuleDetailList[].ruleType:VARCHAR#, #insertRuleDetailList[].ruleId:INT#, #insertRuleDetailList[].remark:VARCHAR#, DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s"),
      DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s"), #insertRuleDetailList[].state:VARCHAR#, #insertRuleDetailList[].description:VARCHAR#, #insertRuleDetailList[].endTime:VARCHAR#,
      #insertRuleDetailList[].startTime:VARCHAR#, #insertRuleDetailList[].intervalTime:VARCHAR#, #insertRuleDetailList[].paymentStartTime:VARCHAR#, #insertRuleDetailList[].formula:VARCHAR#,
      #insertRuleDetailList[].ruleDetailTempletId:INT#, #insertRuleDetailList[].ruleDetailType:VARCHAR#)
    </iterate>
  
  </insert>
  
  
  <insert id="abatorgenerated_insert" parameterClass="com.froad.CB.po.RuleDetail" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Wed Jan 30 18:03:53 CST 2013.
    -->
    insert into rule_detail (id, rule_type, rule_id, remark, update_time, create_time, state,
      description, end_time, start_time, interval_time, payment_start_time, formula,
      rule_detail_templet_id, rule_detail_type)
    values (#id:INT#, #ruleType:VARCHAR#, #ruleId:INT#, #remark:VARCHAR#, DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s"),
      DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s"), #state:VARCHAR#, #description:VARCHAR#, #endTime:VARCHAR#,
      #startTime:VARCHAR#, #intervalTime:VARCHAR#, #paymentStartTime:VARCHAR#, #formula:VARCHAR#,
      #ruleDetailTempletId:INT#, #ruleDetailType:VARCHAR#)
      <selectKey resultClass="int" keyProperty="id">
			select last_insert_id() as id
		</selectKey>
  </insert>
  <update id="abatorgenerated_updateByPrimaryKey" parameterClass="com.froad.CB.po.RuleDetail" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Wed Jan 30 18:03:53 CST 2013.
    -->
    update rule_detail
    set rule_type = #ruleType:VARCHAR#,
      rule_id = #ruleId:INT#,
      remark = #remark:VARCHAR#,
      update_time = DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s"),
      state = #state:VARCHAR#,
      description = #description:VARCHAR#,
      end_time = #endTime:VARCHAR#,
      start_time = #startTime:VARCHAR#,
      interval_time = #intervalTime:VARCHAR#,
      payment_start_time = #paymentStartTime:VARCHAR#,
      formula = #formula:VARCHAR#,
      rule_detail_templet_id = #ruleDetailTempletId:INT#,
      rule_detail_type = #ruleDetailType:VARCHAR#
    where id = #id:INT#
  </update>
 
  <update id="abatorgenerated_updateByPrimaryKeySelective" parameterClass="com.froad.CB.po.RuleDetail" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Wed Jan 30 18:03:53 CST 2013.
    -->
    update rule_detail set update_time =DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s")
    <dynamic>
      <isNotNull prepend="," property="ruleType" >
        rule_type = #ruleType:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="ruleId" >
        rule_id = #ruleId:INT#
      </isNotNull>
      <isNotNull prepend="," property="remark" >
        remark = #remark:VARCHAR#
      </isNotNull>
     
      <isNotNull prepend="," property="state" >
        state = #state:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="description" >
        description = #description:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="endTime" >
        end_time = #endTime:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="startTime" >
        start_time = #startTime:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="intervalTime" >
        interval_time = #intervalTime:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="paymentStartTime" >
        payment_start_time = #paymentStartTime:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="formula" >
        formula = #formula:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="ruleDetailTempletId" >
        rule_detail_templet_id = #ruleDetailTempletId:INT#
      </isNotNull>
      <isNotNull prepend="," property="ruleDetailType" >
        rule_detail_type = #ruleDetailType:VARCHAR#
      </isNotNull>
    </dynamic>
    where id = #id:INT#
  </update>
  
  <select id="selectRuleDetails"  resultMap="abatorgenerated_RuleDetailResult"   parameterClass="com.froad.CB.po.RuleDetail" >
  select * from rule_detail
  <dynamic prepend="where" >
   <isNotNull prepend="and" property="ruleType" >
        rule_type = #ruleType:VARCHAR#
      </isNotNull>
      <isNotNull prepend="and" property="ruleId" >
        rule_id = #ruleId:INT#
      </isNotNull>
      <isNotNull prepend="and" property="remark" >
        remark = #remark:VARCHAR#
      </isNotNull>
      <isNotNull prepend="and" property="updateTime" >
        update_time = #updateTime:VARCHAR#
      </isNotNull>
      <isNotNull prepend="and" property="createTime" >
        create_time = #createTime:VARCHAR#
      </isNotNull>
      <isNotNull prepend="and" property="state" >
        state = #state:VARCHAR#
      </isNotNull>
      <isNotNull prepend="and" property="description" >
        description = #description:VARCHAR#
      </isNotNull>
      <isNotNull prepend="and" property="endTime" >
        end_time = #endTime:VARCHAR#
      </isNotNull>
      <isNotNull prepend="and" property="startTime" >
        start_time = #startTime:VARCHAR#
      </isNotNull>
      <isNotNull prepend="and" property="intervalTime" >
        interval_time = #intervalTime:VARCHAR#
      </isNotNull>
      <isNotNull prepend="and" property="paymentStartTime" >
        payment_start_time = #paymentStartTime:VARCHAR#
      </isNotNull>
      <isNotNull prepend="and" property="formula" >
        formula = #formula:VARCHAR#
      </isNotNull>
      <isNotNull prepend="and" property="ruleDetailTempletId" >
        rule_detail_templet_id = #ruleDetailTempletId:INT#
      </isNotNull>
      <isNotNull prepend="and" property="ruleDetailType" >
        rule_detail_type = #ruleDetailType:VARCHAR#
      </isNotNull>
  </dynamic>
  </select>
  
  <update id="updateRuleDetailByRule" parameterClass="com.froad.CB.po.RuleDetail">
   update rule_detail set update_time =DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s"),state = #state:VARCHAR#
   where rule_id = #ruleId:INT# and  rule_type = #ruleType:VARCHAR#
  </update>
  
   <select id="selectRuleDetailByRuleId2" resultMap="abatorgenerated_RuleDetailResult" parameterClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Wed Jan 30 18:03:53 CST 2013.
    -->
    select *
    from rule_detail
     where rule_id = #value#    
  </select>
  
  <select id="selectRuleDetailByRuleId" resultMap="abatorgenerated_RuleDetailResult2" parameterClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Wed Jan 30 18:03:53 CST 2013.
    -->
    select *
    from (	select *
    		from rule_detail
     		where rule_id = #value#)d left join (select id as ruleDetailTemplet_id, seq_no as ruleDetailTemplet_seq_no, rule_type as ruleDetailTemplet_rule_type, to_account_type as ruleDetailTemplet_to_account_type, 
    from_account_type as ruleDetailTemplet_from_account_type , remark as ruleDetailTemplet_remark , 
     state as ruleDetailTemplet_state , description as ruleDetailTemplet_description , 
      param_of_formula_from as ruleDetailTemplet_param_of_formula_from,
       param_of_formula as ruleDetailTemplet_param_of_formula , settle_type as ruleDetailTemplet_settle_type,
      use_time as ruleDetailTemplet_use_time , clazz_name as ruleDetailTemplet_clazz_name , detail_rule_formula_from as ruleDetailTemplet_detail_rule_formula_from, 
      calculate_type as ruleDetailTemplet_calculate_type , to_role as ruleDetailTemplet_to_role , from_role as ruleDetailTemplet_from_role ,
      rule_detail_type as ruleDetailTemplet_rule_detail_type ,formula_of_detail_rule as ruleDetailTemplet_formula_of_detail_rule ,
      detail_rule_formula_from_type as ruleDetailTemplet_detail_rule_formula_from_type ,rule_detail_category as ruleDetailTemplet_rule_detail_category  
     											from rule_detail_templet
     											where rule_detail_templet.state='30')t
    on d.rule_detail_templet_id=t.ruleDetailTemplet_id
    order by t.ruleDetailTemplet_seq_no asc
  </select>
 
</sqlMap>