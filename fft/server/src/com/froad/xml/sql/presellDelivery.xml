<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="presellDelivery">
	<typeAlias alias="presellDelivery" type="com.froad.CB.po.PresellDelivery" />	
	<resultMap class="presellDelivery" id="presellDeliveryResult">
		<result property="id" column="id" jdbcType="INTEGER"/>
		<result property="name" column="name" jdbcType="VARCHAR"/>
		<result property="address" column="address" jdbcType="VARCHAR"/>
		<result property="telephone" column="telephone" jdbcType="VARCHAR"/>
		<result property="businessTime" column="business_time" jdbcType="VARCHAR"/>
		<result property="coordinate" column="coordinate" jdbcType="VARCHAR"/>
		<result property="state" column="state" jdbcType="VARCHAR"/>
		<result property="createTime" column="create_time" jdbcType="VARCHAR"/>
		<result property="updateTime" column="update_time" jdbcType="VARCHAR"/>		
	</resultMap>
		
	<insert id="insert" parameterClass="presellDelivery">
		insert into presell_delivery (name,address,telephone,business_time,coordinate,state,create_time,update_time) values(
			#name#,#address#,#telephone#,#businessTime#,#coordinate#,2,
			DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s"),
			DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s")
		)		
		<selectKey keyProperty="id" resultClass="int">
			select last_insert_id() as id
		</selectKey>
	</insert>
	
	<update id="updateById" parameterClass="presellDelivery" >
		update presell_delivery set update_time=DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s")
		<dynamic prepend="">
			<isNotEmpty property="name" prepend=",">
				name=#name#
			</isNotEmpty>
			<isNotEmpty property="address" prepend=",">
				address=#address#
			</isNotEmpty>	
			<isNotEmpty property="telephone" prepend=",">
				telephone=#telephone#
			</isNotEmpty>
			<isNotEmpty property="businessTime" prepend=",">
				business_time=#businessTime#
			</isNotEmpty>
			<isNotEmpty property="coordinate" prepend=",">
				coordinate=#coordinate#
			</isNotEmpty>	
			<isNotEmpty property="state" prepend=",">
				state=#state#
			</isNotEmpty>			
		</dynamic>		
			where id=#id#	
	</update>
	
	<select id="getById" parameterClass="java.lang.Integer" resultMap="presellDeliveryResult">
		select * from presell_delivery where id=#id#	
	</select>
	
	<select id="getByConditions" parameterClass="presellDelivery" resultMap="presellDeliveryResult">
		select * from presell_delivery 
		<dynamic prepend="where">
			<isNotEmpty property="id" prepend="and">
				id=#id#
			</isNotEmpty>			
			<isNotEmpty property="name" prepend="and">
				name like concat('%',#name#,'%')
			</isNotEmpty>
			<isNotEmpty property="address" prepend="and">
				address=#address#
			</isNotEmpty>	
			<isNotEmpty property="telephone" prepend="and">
				telephone=#telephone#
			</isNotEmpty>	
			<isNotEmpty property="businessTime" prepend="and">
				business_time=#businessTime#
			</isNotEmpty>
			<isNotEmpty property="coordinate" prepend="and">
				coordinate=#coordinate#
			</isNotEmpty>	
			<isNotEmpty property="state" prepend="and">
				state=#state#
			</isNotEmpty>		
		</dynamic>	
	</select>	
	
	<select id="getByPager" parameterClass="presellDelivery" resultMap="presellDeliveryResult"> 
		select * from presell_delivery
		<dynamic prepend="where">
			<isNotEmpty property="id" prepend="and">
				id=#id#
			</isNotEmpty>			
			<isNotEmpty property="name" prepend="and">
				name like concat('%',#name#,'%')
			</isNotEmpty>
			<isNotEmpty property="address" prepend="and">
				address=#address#
			</isNotEmpty>	
			<isNotEmpty property="telephone" prepend="and">
				telephone=#telephone#
			</isNotEmpty>	
			<isNotEmpty property="state" prepend="and">
				state=#state#
			</isNotEmpty>					
		</dynamic>	
			    <![CDATA[ 
            	order by $orderBy$ $orderType$ 
            	limit #startRow#,#pageSize#  
            ]]> 
	</select>
	
	<select id="getByPagerCount" parameterClass="presellDelivery" resultClass="java.lang.Integer"> 
		select count(*) from presell_delivery
		<dynamic prepend="where">
			<isNotEmpty property="id" prepend="and">
				id=#id#
			</isNotEmpty>			
			<isNotEmpty property="name" prepend="and">
				name like concat('%',#name#,'%')
			</isNotEmpty>
			<isNotEmpty property="address" prepend="and">
				address=#address#
			</isNotEmpty>	
			<isNotEmpty property="telephone" prepend="and">
				telephone=#telephone#
			</isNotEmpty>	
			<isNotEmpty property="state" prepend="and">
				state=#state#
			</isNotEmpty>					
		</dynamic>	
	</select>

    <select id="getByRackId" parameterClass="java.lang.Integer" resultMap="presellDeliveryResult">
    	select * from presell_delivery d where d.id in (select m.delivery_id from presell_delivery_map m where m.presell_rack_id=#rackId#) order by d.id desc
    </select>
    <select id="getDeliveryPagerByRackId" parameterClass="java.util.Map" resultMap="presellDeliveryResult">
       	select * from presell_delivery d where d.id in (select m.delivery_id from presell_delivery_map m where m.presell_rack_id=#rackId#) order by d.id desc
       	  <![CDATA[
            	limit #startRow#,#pageSize#
            ]]>
       </select>
    <select id="getDeliveryPagerByRackIdCount" parameterClass="java.util.Map"  resultClass="java.lang.Integer">
           	select count(*) from presell_delivery d where d.id in (select m.delivery_id from presell_delivery_map m where m.presell_rack_id=#rackId#) order by d.id desc
           	  <![CDATA[
                	limit #startRow#,#pageSize#
                ]]>
           </select>
	<select id="queryByTransId" parameterClass="java.lang.Integer" resultMap="presellDeliveryResult">
		select * from presell_delivery where id = (select presell_delivery_id from presell_buy_info where trans_id=#transId#)
	</select>

</sqlMap>