<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="seller">
	
	<typeAlias alias="seller" type="com.froad.CB.po.Seller" />

	<resultMap class="seller" id="sellerResult">
		<result property="id" column="id"/>
		<result property="sellerChannelList" column="id" select="sellerChannel.getSellerChannelBySellerId"/>
		<result property="userId" column="user_id"/>
		<result property="merchantId" column="merchant_id"/>
		<result property="state" column="state"/>
		<result property="createTime" column="create_time"/>
		<result property="updateTime" column="update_time"/>
		<result property="sellerType" column="seller_type"/>
		<result property="remark" column="remark"/>
		<result property="isInternal" column="is_internal"/>
	</resultMap>
	
	<!-- 添加卖家信息 -->
	<insert id="addSeller" parameterClass="seller">
		<![CDATA[ 
				insert into seller(id,is_internal,seller_type,user_id,merchant_id,state,create_time,update_time,remark) 
				values(#id#,#isInternal#,#sellerType#,#userId#,#merchantId#,#state#,DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s"),DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s"),#remark#)
		]]>
			<selectKey keyProperty="id" resultClass="int">
				select last_insert_id() as id
			</selectKey>
	</insert>
	
	<!-- 更新卖家信息  -->
	<update id="updateSellerById" parameterClass="seller" >
	    <![CDATA[ 
	    		update seller a 
	    		set a.update_time = DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s")
	    ]]>
		<dynamic>
		     <isNotEmpty prepend="," property="userId">
		         <![CDATA[  a.user_id = #userId# ]]>
		     </isNotEmpty> 
		     <isNotEmpty prepend="," property="sellerType">
		         <![CDATA[  a.seller_type = #sellerType# ]]>
		     </isNotEmpty>
		     <isNotEmpty prepend="," property="merchantId">
		         <![CDATA[  a.merchant_id = #merchantId# ]]>
		     </isNotEmpty> 
		     <isNotEmpty prepend="," property="state">
		         <![CDATA[  a.state = #state# ]]>
		     </isNotEmpty> 
		     <isNotEmpty prepend="," property="remark">
		         <![CDATA[  a.remark = #remark# ]]>
		      </isNotEmpty> 
		</dynamic>
		<![CDATA[ where a.id = #id# ]]>
	</update>
	
	<!-- 根据id物理删除卖家信息 -->
	<delete id="deleteByPrimaryKey" parameterClass="seller" >
	    <![CDATA[ 
    			delete from seller where id = #id#
	     ]]>
	</delete>
	
	<!-- 根据id删除卖家信息 -->
	<update id="deleteStateByPrimaryKey" parameterClass="seller" >
	    <![CDATA[ 
    			update seller a 
		     	set 
		     	a.update_time = DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s"),a.state = '50'
		     	where a.id = #id:INT#
	     ]]>
	</update>
	
	<!-- 根据userId查询卖家信息 -->
	<select id="getSellerByUserId" parameterClass="string" resultMap="sellerResult">
		select * from seller a where a.user_id=#userId# 
	</select>
	
	<!-- 根据merchantId查询卖家信息 -->
	<select id="getSellerByMerchantId" parameterClass="string" resultMap="sellerResult">
		select * from seller a where a.state = '30' and a.merchant_id=#merchantId#
	</select>
	
	<!-- 根据主键编号查询卖家信息 -->
	<select id="selectByPrimaryKey" parameterClass="java.lang.Integer" resultMap="sellerResult">
		select * from seller a where a.id=#id#
	</select>
	
  <select id="selectBySelective" parameterClass="seller" resultMap="sellerResult">
  	select * from seller
	  	<dynamic prepend="where">
	      <isNotEmpty prepend="and" property="id" >
	        id = #id:INTEGER#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="merchantId" >
	        merchant_id = #merchantId:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="state" >
	        state = #state:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="createTime" >
	        <![CDATA[create_time>=#createTime:VARCHAR#]]>
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="updateTime" >
	        update_time = #updateTime:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="userId" >
	        user_id = #userId:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="sellerType" >
	        seller_type = #sellerType:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="isInternal" >
	        is_internal = #isInternal:VARCHAR#
	      </isNotEmpty>
		</dynamic>
  </select>
	
</sqlMap>