<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="buyerChannel">
	
	<typeAlias alias="buyerChannel" type="com.froad.CB.po.BuyerChannel" />

	<resultMap class="buyerChannel" id="BuyerChannelResult">
		<result property="id" column="id"/>
		<result property="userId" column="user_id"/>
		<result property="buyersId" column="buyers_id"/>
		<result property="buyersRuleId" column="buyers_rule_id"/>
		<result property="channelId" column="channel_id"/>
		<result property="fundsChannel" column="channel_id" select="fundsChannel.selectByPrimaryKey"/>
		<result property="isDefault" column="is_default"/>
		<result property="accountName" column="account_name"/>
		<result property="accountNumber" column="account_number"/>		
		<result property="state" column="state"/>
		<result property="createTime" column="create_time"/>
		<result property="updateTime" column="update_time"/>
		<result property="remark" column="remark"/>
		<result property="phone" column="phone"/>
	</resultMap>
	
	<!-- 添加买家支付渠道信息 -->
	<insert id="addBuyerChannel" parameterClass="buyerChannel">
		<![CDATA[ 
				insert into buyer_channel(id,user_id,buyers_id,buyers_rule_id,channel_id,is_default,account_name,account_number,state,create_time,update_time,remark,phone) 
				values(#id#,#userId#,#buyersId#,#buyersRuleId#,#channelId#,#isDefault#,#accountName#,#accountNumber#,#state#,DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s"),DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s"),#remark#,#phone#)
		]]>
		<selectKey keyProperty="id" resultClass="java.lang.Integer">
			select last_insert_id() as id
		</selectKey>
	</insert>
	
	<!-- 更新买家账户信息 以buyersId作条件 -->
	<update id="updateChannelByBuyerId" parameterClass="buyerChannel">
		update buyer_channel set update_time =DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s")
		<dynamic>
			<isNotEmpty property="state" prepend=",">
			    state=#state#
			</isNotEmpty>
			<isNotEmpty property="channelId" prepend=",">
			    channel_id=#channelId#
			</isNotEmpty>
			<isNotEmpty property="accountName" prepend=",">
				account_name=#accountName#
			</isNotEmpty>
			<isNotEmpty property="accountNumber" prepend=",">
				account_number=#accountNumber#
			</isNotEmpty>
			<isNotEmpty property="phone" prepend=",">
				phone=#phone#
			</isNotEmpty>
		</dynamic>
		 where buyers_id=#buyersId#
	</update>
	
	<!-- 更新买家支付渠道信息  -->
	<update id="updateBuyerChannelById" parameterClass="buyerChannel" >
	    <![CDATA[ 
	    		update buyer_channel a 
	    		set a.update_time = DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s")
	    ]]>
		<dynamic>
		     <isNotEmpty prepend="," property="userId">
		         <![CDATA[  a.user_id = #userId# ]]>
		     </isNotEmpty> 
		     <isNotEmpty prepend="," property="buyersId">
		         <![CDATA[  a.buyers_id = #buyersId# ]]>
		     </isNotEmpty> 
		     <isNotEmpty prepend="," property="buyersRuleId">
		         <![CDATA[  a.buyers_rule_id = #buyersRuleId# ]]>
		     </isNotEmpty> 
		     <isNotEmpty prepend="," property="channelId">
		         <![CDATA[  a.channel_id = #channelId# ]]>
		     </isNotEmpty> 
		     <isNotEmpty prepend="," property="isDefault">
		         <![CDATA[  a.is_default = #isDefault# ]]>
		     </isNotEmpty>
		     <isNotEmpty prepend="," property="accountName">
		         <![CDATA[  a.account_name = #accountName# ]]>
		     </isNotEmpty>  
		     <isNotEmpty prepend="," property="accountNumber">
		         <![CDATA[  a.account_number = #accountNumber# ]]>
		     </isNotEmpty> 
		     <isNotEmpty prepend="," property="state">
		         <![CDATA[  a.state = #state# ]]>
		     </isNotEmpty> 
		     <isNotEmpty prepend="," property="remark">
		         <![CDATA[  a.remark = #remark# ]]>
		      </isNotEmpty> 
		</dynamic>
		<![CDATA[ where a.id = #id# ]]>
	</update>
	
	<!-- 根据id物理删除买家支付渠道信息 -->
	<delete id="deleteByPrimaryKey" parameterClass="buyerChannel" >
	    <![CDATA[ 
    			delete from buyer_channel where id = #id#
	     ]]>
	</delete>
	
	<!-- 根据id删除买家支付渠道信息 -->
	<update id="deleteStateByPrimaryKey" parameterClass="buyerChannel" >
	    <![CDATA[ 
    			update buyer_channel a 
		     	set a.update_time = DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s"),a.state = '50'
		     	where a.id = #id:INT#
	     ]]>
	</update>
	
	<!-- 根据userId查询买家支付渠道信息 -->
	<select id="getBuyerChannelByUserId" parameterClass="string" resultMap="BuyerChannelResult">
		select * from buyer_channel a where a.user_id=#userId#
	</select>
	
	<!-- 根据buyersId查询买家支付渠道信息 -->
	<select id="getBuyerChannelByBuyerId" parameterClass="string" resultMap="BuyerChannelResult">
		select * from buyer_channel a where a.buyers_id=#buyersId#
	</select>
	
	<!-- 根据主键编号查询买家支付渠道信息 -->
	<select id="selectByPrimaryKey" parameterClass="java.lang.Integer" resultMap="BuyerChannelResult">
		select * from buyer_channel a where a.id=#id#
	</select>
	
	<update id="initAllDefault">
		<![CDATA[ 
		update buyer_channel set update_time = DATE_FORMAT(NOW(),"%Y-%m-%d|%H:%i:%s"),is_default="0"
		]]>
	</update>
	
	<update id="setDefault" parameterClass="java.lang.Integer">
		update buyer_channel set is_default="1" where id=#id#
	</update>
</sqlMap>